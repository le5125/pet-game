<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>電子寵物</title>

<!-- ========== CSS  ========== -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>

<!-- 🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨 CSS 樣式區塊 START 🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨 -->
<style>
   /* 🧱 全域設定：基本頁面格式與預設樣式 */
html, body {
    height: 100%;               /* 全頁滿高 */
    margin: 0;                  /* 移除預設邊距 */
    padding: 0;                 /* 移除預設內距 */
    font-size: 48px;            /* 全站基礎字體大小（含 icon 用） */
    background-color: #fff;     /* 預設背景為白色 */
    overflow: hidden;           /* 防止畫面捲動 */
}

/* 🔴 主角圓點角色樣式（用圖片表示） */
.sprite {
  width: 400px;
  height: 400px;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
}

/* 🔋 狀態條基礎樣式（用於飽足、快樂、清潔等） */
.status-bar {
    height: 10px;               /* 狀態條高度 */
    border-radius: 5px;         /* 圓角設計 */
    transition: width 0.3s ease;/* 寬度變化加入動畫過渡效果 */
}

/* 💬 對話泡泡樣式（角色說話使用） */

.speech-bubble {
    position: absolute;         /* 讓泡泡浮動在角色上方 */
    background: white;          /* 背景白色 */
    border-radius: 10px;        /* 圓角泡泡 */
    padding: 12px 20px;         /* 內距調整文字間距 */
    font-size: 36px;            /* 文字大小 */
    box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* 陰影效果 */
    white-space: nowrap;        /* 單行不換行 */
    display: inline-block;      /* 自動寬度顯示 */
    opacity: 0;                 /* 預設隱藏，透過 JS 控制顯示 */
    transition: opacity 0.3s ease;       /* 顯示與隱藏的動畫 */
    pointer-events: none;       /* 不影響滑鼠點擊 */
    top: -60px;                 /* 從角色頂端往上偏移 */
    left: 50%;                  /* 水平置中 */
    transform: translateX(-50%);/* 水平移動置中對齊 */
    max-width: 90vw;            /* 最多不要超出畫面寬度 */
    word-break: break-word;            /* ✅ 中文會自動斷行 */
    overflow: hidden;           /* 超出部分隱藏 */
    text-overflow: ellipsis;    /* 超過加上 ... */
}

/* 💬 對話泡泡箭頭樣式（三角形指向角色） */
.speech-bubble:after {
    content: '';                            /* 顯示空內容產生箭頭 */
    position: absolute;
    left: 50%;                              /* 置中 */
    bottom: -10px;                          /* 從下方延伸箭頭 */
    transform: translateX(-50%);            /* 對齊中心 */
    border-width: 10px 10px 0 10px;         /* 上方三角形 */
    border-style: solid;
    border-color: white transparent transparent transparent; /* 白色箭頭 */
}

/* ⛳ walk：模擬角色左右搖擺＋上下小幅移動，表現出「走路中」的效果 */
@keyframes walk {
  0%, 100% { transform: translateX(0) translateY(0); }        /* 起點與終點歸位 */
  25%      { transform: translateX(5px) translateY(-2px); }   /* 微往右上 */
  50%      { transform: translateX(10px) translateY(0); }     /* 更往右但回中線 */
  75%      { transform: translateX(5px) translateY(2px); }    /* 往右下 */
}
/* 🍽️ eat：角色垂直方向輕微彈跳，模擬「吃東西時點頭」的效果 */
@keyframes eat {
  0%, 100% { transform: translateY(0); }                      /* 預設位置 */
  50%      { transform: translateY(5px); }                    /* 向下壓 */
}
/* 🎮 play：左右旋轉擺動，模擬角色「玩耍中，興奮扭動」的效果 */
@keyframes play {
  0%, 100% { transform: rotate(0deg); }                       /* 回歸原角度 */
  25%      { transform: rotate(5deg); }                       /* 向右轉 */
  75%      { transform: rotate(-5deg); }                      /* 向左轉 */
}
/* 💤 sleep：角色睡覺時會微微左右晃並上下移動，模擬呼吸感 */
@keyframes sleep {
  0%   { transform: rotate(0deg) translateY(0); }             /* 靜止 */
  50%  { transform: rotate(5deg) translateY(5px); }           /* 微微旋轉與沉下 */
  100% { transform: rotate(0deg) translateY(0); }             /* 回到原點 */
}
/* 💤 sleepZzz：上升消失的 Zzz 氣泡動畫，用來顯示在角色旁邊 */
@keyframes sleepZzz {
  0%   { opacity: 0; transform: translateY(0); }              /* 開始隱形在原地 */
  50%  { opacity: 1; }                                        /* 漸漸浮現 */
  100% { opacity: 0; transform: translateY(-20px); }          /* 上升並消失 */
}
/* 🎬 狀態類別：角色當前狀態對應動畫，透過 JS 動態加上 class */
.walking {
  animation: walk 0.5s infinite;/* 🚶‍♂️ walking：角色正在移動時加上，觸發 walk 動畫 */
}
.eating {
  animation: eat 0.3s infinite;/* 🍔 eating：角色進食中，觸發 eat 動畫（上下點頭） */
}
.playing {
  animation: play 0.5s infinite;/* 🪀 playing：角色玩耍中，觸發旋轉動畫 */
}
.sleeping {
  animation: sleep 2s infinite;/* 🛌 sleeping：角色睡著了，觸發旋轉＋下沉的睡覺動畫 */
}
/* 💭 zzz：搭配睡覺狀態，在角色旁飄出 Zzz 泡泡（需放在角色旁邊的 span 或 div） */
.zzz {
  position: absolute;                    /* 相對於角色容器定位 */
  animation: sleepZzz 2s infinite;       /* 持續執行 Zzz 動畫 */
  font-size: 80px;
  color: #666;                           /* 淡灰色，避免過於顯眼 */
}

/* 🐣 角色容器位置與動畫過渡 */
/* .chicken-container：主要角色外框，包含圖片、動畫等元素，固定置中 */
.chicken-container {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);      /* 精準置中畫面 */
  transition: all 0.3s ease;             /* 任意位置或大小改變時滑順過渡 */
  z-index: 20;                           /* 在背景與場景上方，避免被蓋住 */
}

/* 🍗 食物與玩具元素樣式：投放後角色可以互動的物件 */

/* 共用設定：絕對定位＋滑鼠變手＋ hover 放大動畫 */
.food-item,
.toy-item {
  position: absolute;                    /* 投放在畫面任意位置 */
}
/* 食物尺寸較小（例如飼料粒） */
.food-item {
  width: 20px;
  height: 20px;
}
/* 玩具尺寸略大（例如球） */
.toy-item {
  width: 30px;
  height: 30px;
}
/* 滑鼠懸停時變大，吸引點擊 */
.food-item:hover,
.toy-item:hover {
  transform: scale(1.2);
}

/* .poop：角色排便後生成，為一個固定圖片，出現在畫面上隨機位置 */
.poop {
  width: 100px;
  height: 100px;
  background-image: url('https://i.imgur.com/n1wu20p.png'); /* 固定大便圖片 URL */
  background-size: contain;             /* 依比例縮放圖片填滿 */
  background-repeat: no-repeat;         /* 不重複貼圖 */
  background-position: center;          /* 圖片置中 */
  position: absolute;                   /* 可任意定位在畫面上 */
  overflow: hidden;                     /* 避免內容溢出影響排版 */
  z-index: 25;                          /* 確保在角色底下、背景之上 */
}
/* 🧱 背包格子容器設定 */
/* 🔹 控制整個背包的排列方式與滾動範圍 */
#backpack-items {
  display: grid;                         /* 使用 CSS Grid 佈局，方便製作格子網格 */
  grid-template-columns: repeat(6, 1fr);/* 每列 6 格，每格平均分配寬度 */
  gap: 16px;                             /* 每格之間的間距 */
  max-height: 600px;                     /* 背包最大高度，超過會出現捲軸 */
  overflow-y: auto;                      /* 垂直方向可捲動，適用道具過多時 */
}
/* 📦 單一格子的樣式（即每個背包格子） */
.backpack-slot {
  width: 100px;                          /* 每格寬度固定 */
  height: 100px;                         /* 每格高度固定 */
  border: 2px solid #999;                /* 灰色邊框 */
  border-radius: 8px;                    /* 邊框圓角 */
  background-color: #fdfdfd;             /* 背景淡灰白 */
  display: flex;                         /* 使用 Flex 對齊內容 */
  justify-content: center;              /* 水平置中 */
  align-items: center;                  /* 垂直置中 */
  font-size: 24px;                       /* 內容文字大小（若有預設內容） */
  font-weight: bold;                     /* 粗體 */
  position: relative;                    /* 為了讓 item-count 能定位在右下角 */
}

/* 🔢 顯示該物品數量的右下角小標籤 */
.item-count {
  position: absolute;                    /* 定位在格子右下角 */
  bottom: 4px;
  right: 6px;
  font-size: 18px;                       /* 數字字體稍微小 */
  background-color: rgba(0,0,0,0.6);     /* 黑色半透明底色，避免被背景干擾 */
  color: white;                          /* 白字顯示數量 */
  padding: 2px 6px;                      /* 適度內距，美觀圓角效果 */
  border-radius: 6px;
}
/* 🎒 背包模態框叉叉樣式 */
#backpack-modal .close-button i {
  position: absolute;
  top: 12px;
  right: 12px;
  font-size: 100px;
  color: #555;
  background: none;
  border: none;
  cursor: pointer;
  z-index: 10;
  transition: color 0.2s;
}

#backpack-modal .close-button:hover i {
  color: #e11d48;
}

/* 🎯 探險模態框內容寬度調整（地點選擇用） */
/* 🧭 控制 #explore-modal 裡的內容大小與排版 */
#explore-modal .modal-content {
  width: 800px;                          /* 固定寬度，也可視需求調整 */
  height: auto;                          /* 高度自動撐開 */
  max-width: 90vw;                       /* 行動裝置下不超出畫面寬度 */
  padding: 32px;                         /* 內距增大，讓內容不貼邊 */
}
/* 探險模態框中的標題置中顯示 */
#explore-modal .modal-content h2 {
  text-align: center;
}

/* 探險模態框中的按鈕樣式（如三個地點） */
#explore-modal .modal-content button {
  font-size: 80px;                       /* 字大一點，方便點擊 */
  padding: 40px;                         /* 加大按鈕範圍，增強可點擊性 */
}

/* 🎁 探險獎勵模態框設定（當探險結束顯示獲得道具） */
#explore-reward-modal .modal-content {
  width: 1200px;                          /* 略小於探險地點選單 */
  height: auto;                          /* 高度根據內容調整 */
}
/* ✨ 自訂探險模態框的叉叉樣式 */
#explore-modal .close-button i {
  position: absolute;
  top: 12px;              /* 你可以調整這裡上下位置 */
  right: 12px;            /* 你可以調整這裡左右位置 */
  font-size: 100px;        /* 調整大小（越大越明顯） */
  color: #555;            /* 預設顏色 */
  background: none;       /* 移除背景 */
  border: none;           /* 移除邊框 */
  cursor: pointer;        /* 滑鼠變手指 */
  z-index: 10;            /* 確保在最上層 */
  transition: color 0.2s;
}

#explore-modal .close-button:hover {
  color: #e11d48;         /* hover 時變紅色（Tailwind red-600） */
}

/* 🐔 寵物場景主要區域背景容器 */
/* 👇 控制整個遊戲畫面的背景圖呈現與覆蓋方式 */
.pet-area {
  position: fixed;                       /* 固定在整個畫面不隨滾動移動 */
  top: 0;
  left: 0;
  width: 100vw;                          /* 寬度等於整個視窗寬度 */
  height: 100vh;                         /* 高度等於整個視窗高度 */
  background-size: cover;               /* 背景圖放大縮小以完全覆蓋畫面 */
  background-position: center;          /* 背景圖置中 */
  background-repeat: no-repeat;         /* 不重複貼圖（單張背景） */
  z-index: 0;                            /* 放在最底層，其他物件蓋在上面 */
  overflow: hidden;                     /* 多出的內容不顯示，避免畫面破版 */
  position: relative;                   /* 為內部絕對定位元件提供定位參考 */
}


/* 👤 玩家資訊群（左上角） */
.info-panel {
  position: absolute;           /* 固定位置，不受其他元素影響 */
  top: 10px;                    /* 距離畫面頂端 10px */
  left: 10px;                   /* 距離左側 10px */
  right: 10px;                  /* 可搭配 flex 撐開整個寬度 */
  z-index: 9999;                /* 疊在最上層，避免被遮擋 */
  display: flex;                /* 啟用 flex 排列 */
  flex-direction: row;         /* 子項目橫向排列 */
  align-items: center;         /* 子元素垂直置中 */
  gap: 12px;                    /* 子元素之間的距離 */
  transform: scale(1);         /* 整體縮放大小（你可以調整比例） */
  transform-origin: top left;  /* 縮放基準點：左上角 */
  background: #fff;            /* 白色背景 */
  border-radius: 999px;        /* 全圓角 → 形成橢圓 */
  padding: 6px 16px;           /* 上下 6px、左右 16px 的內距 */
  box-shadow: 0 0 6px rgba(0,0,0,0.1); /* 陰影增加立體感 */
}

/* 左邊等級圓環 */
.level-circle {
  width: 100px;
  height:100px;
  margin-top: -30px;   /* ✅ 往上拉一點 */
  margin-left: 0px;   /* ✅ 往右推一點 */
}

.level-circle-svg {
  width: 130px;       /* SVG 寬度 */
  height: 130px;      /* SVG 高度 */
}

.bg {
  fill: none;         /* 無填色 */
  stroke: #eee;       /* 淺灰色外框圓圈 */
  stroke-width: 3;    /* 線條寬度 */
}

.progress {
  stroke: orange;     /* 經驗條顏色 */
  stroke-width: 3;
  fill: none;
  transform: rotate(0deg);       /* 不旋轉（保留） */
  transform-origin: center;
}
.level-text {
  font-size: 10px;
  fill: black;
  font-weight: bold;
}

.level-number {
  font-size: 10px;
  fill: black;
  font-weight: bold;
}

.level-label {
  transform: translateY(5px) scale(1.3); /* 讓 Lv + 數字整體往下移動＋放大 */
  transform-origin: center;
}
.center-info {
  display: flex;
  flex-direction: column;
  justify-content: center;
 
}

.name-row {
  display: flex;
  align-items: center;
  gap: 6px;                      /* 名字與筆圖示之間間距 */
}

#pet-name-display {
  font-weight: bold;
  font-size: 36px;
  margin-left: 20px;   /* ✅ 往右推一點 */
}

#rename-btn {
  background: none;
  border: none;
  color: #555;
  font-size: 36px;
  cursor: pointer;
}

.status-row {
  font-size: 36px;
  color: #444;
  margin-top: 20px;     /* 👉 往下移動 */
  margin-left: 20px;   /* 👉 往右移動 */
}

.coin-box {
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid orange;
  border-radius: 20px;      /* 外框圓角 */
  padding: 4px 10px;        /* 上下 4px、左右 10px 內距 */
  color: orange;
  font-weight: bold;
  font-size: 36px;
  margin-left: auto;   /* 讓它靠右（必要）*/
  margin-top: -20px;    /* ↑ 往上移（可依需要微調） */
}

#weather-toggle {
  position: fixed;       /* 讓它固定在畫面上 */
  top: 200px;         /* 往上留出空間，避免被最下方按鈕群擋住 */
  left: 40px;            /* 左邊邊距 */
  color: orange;
  font-size: 80px;
  cursor: pointer;
  z-index: 9999;         /* 確保在最上層，不被蓋住 */
}

/* 🎛️ 狀態條群（右上角） */

/* 整體圓圈狀態區塊的樣式設定 */
.status-circles {
  transform: scale(0.9);     /* 將整個區塊縮小 90% */
  gap: 10px;                  /* 每個圓圈之間的間距 */
  margin-left: auto;         /* ✅ 關鍵：讓整塊狀態圓圈靠右對齊 */
}

/* 每個圓圈包裝容器的基本樣式 */
.circle-wrapper {
  text-align: center;        /* 讓內部的文字置中 */
}

/* 設定 SVG 尺寸大小（圓圈大小控制在這裡） */
.circle-svg {
  width: 110px;              /* SVG 寬度 */
  height: 110px;             /* SVG 高度 */
}

/* 灰色背景圓圈樣式 */
.circle-bg {
  stroke: #e5e7eb;           /* 灰色邊框 */
  stroke-width: 10;          /* 圓圈粗細 */
  fill: none;                /* 不填色 */
}

/* 彩色進度條圓圈樣式（前景圈） */
.circle-bar {
  stroke-width: 10;          /* 圓圈粗細 */
  fill: none;                /* 不填色 */
  transform: rotate(-90deg); /* 讓進度從上方開始畫圓 */
  transform-origin: 50% 50%; /* 旋轉中心設定為圓心 */
  stroke-linecap: round;     /* 線尾是圓頭 */
}

/* 下方的百分比數字樣式 */
.status-value {
  font-size: 32px;           /* 字體大小 */
  font-weight: bold;         /* 粗體 */
  margin-top: 4px;           /* 圓圈和數字之間的距離 */
}

/* 圓圈正中央顯示的「飢餓 / 快樂 / 精力 / 清潔」文字樣式 */
.circle-title {
  font-size: 32px;           /* 圓內文字大小 */
  fill: #333;                /* 深灰色字體 */
  font-weight: bold;         /* 粗體 */
  pointer-events: none;      /* 禁止滑鼠事件（避免影響操作） */
}

/* 各個狀態對應的圓圈進度顏色 */
.hunger .circle-bar      { stroke: red; }
.happiness .circle-bar   { stroke: orange; }
.energy .circle-bar      { stroke: blue; }
.cleanliness .circle-bar { stroke: green; }

/* 各個狀態對應的百分比文字顏色 */
.hunger .status-value      { color: red; }
.happiness .status-value  { color: orange; }
.energy .status-value      { color: blue; }
.cleanliness .status-value { color: green; }


/* 🧠 功能按鈕群：底部置中 */
/* 這是控制功能按鈕的主要容器，例如餵食、清潔、睡覺等行為按鈕 */
.control-panel {
  position: absolute;              /* 絕對定位：固定在畫面上 */
  bottom: 20px;                    /* 離畫面底部 20px */
  left: 50%;                       /* 從畫面水平中間開始 */
  transform: translateX(-50%)      /* 水平置中 */ 
             scale(0.3);           /* 整體縮小為 30% 尺寸 */
  transform-origin: bottom center; /* 以底部中心為縮放原點，不跑版 */
  display: grid;                   /* 使用 CSS Grid 排列多個按鈕 */
  grid-template-columns: repeat(4, minmax(60px, 1fr)); /* 建立 4 欄，按鈕寬最少 60px */
  gap: 8px;                        /* 每個按鈕之間間距為 8px */
  z-index: 50;                     /* 蓋過背景、角色、地圖 */
}
/* 🟢 狀態條樣式微調 */
/* 用於所有顯示狀態的進度條（如飽足、快樂等），使其更細緻美觀 */
.status-bar {
  height: 6px;                    /* 狀態條高度為 6px，比原本更細 */
  border-radius: 3px;             /* 圓角為 3px，讓條狀外觀柔和 */
  transition: width 0.3s ease;   /* 寬度變化時添加滑順動畫 */
}
/* 🟠 圓形按鈕統一設定 */
/* 下方是一整套按鈕區塊樣式，讓底部控制按鈕外觀一致、美觀 */

/* 📦 外層容器：固定在底部中間，包住整排按鈕（含按鈕列） */
.button-wrapper {
  position: fixed;                /* 固定定位，滾動畫面時不會動 */
  bottom: 180px;                  /* 離底部 180px（避免遮住 log 視窗） */
  left: 50%;                      /* 從畫面中間開始 */
  transform: translateX(-50%);   /* 水平置中 */
  z-index: 99;                    /* 層級較高，顯示於最上層 */
  display: flex;                  /* Flex 排版（橫排） */
  justify-content: center;       /* 所有內容置中對齊 */
  width: 100%;                   /* 整條寬度為 100%，確保置中 */
}
/* ⭕ 六顆功能按鈕排成一列的容器 */
.button-row {
  display: flex;                  /* 使用 Flex 排版（橫向） */
  flex-wrap: nowrap;             /* 不允許自動換行 */
  gap: 12px;                      /* 按鈕之間間距 12px */
  justify-content: center;       /* 所有按鈕置中 */
  align-items: center;           /* 垂直置中 */
  transform: scale(0.9)
}
/* 🎯 每顆圓形按鈕的統一外觀設定 */
.btn-circle {
  width: 140px;                   /* 按鈕寬度 */
  height: 140px;                  /* 按鈕高度（與寬一致，維持圓形） */
  border-radius: 50%;            /* 完整圓角，變成圓形 */
  padding: 0;                     /* 取消內距，避免內容錯位 */
  display: flex;                 /* 使用 Flex 讓內容置中 */
  flex-direction: column;        /* 內容垂直排列：上 icon、下文字 */
  justify-content: center;       /* 垂直置中 */
  align-items: center;           /* 水平置中 */
  color: white;                  /* 字體顏色為白色（一般搭配彩色背景） */
  font-weight: bold;             /* 字體加粗 */
  box-shadow: 0 4px 6px rgba(0,0,0,0.1); /* 陰影讓按鈕有立體感 */
  text-align: center;            /* 文字置中對齊 */
}
/* ⬆️ 按鈕內的圖示（通常使用 Font Awesome） */
.btn-circle i {
  font-size: 64px;               /* 圖示大小 */
  margin-bottom: 6px;            /* 圖示與文字之間間距 */
  display: block;                /* 獨立一行 */
}
/* ⬇️ 按鈕內的文字說明（在圖示下方） */
.btn-circle span {
  font-size: 42px;               /* 文字大小 */
  line-height: 1;                /* 行高為 1（不加額外空白） */
  display: block;                /* 獨立一行 */
}
/* 📱 響應式設計：手機裝置下按鈕縮小調整 */
@media (max-width: 768px) {
  .btn-circle {
    width: 80px;                 /* 縮小寬度 */
    height: 80px;                /* 縮小高度 */
  }

  .btn-circle i {
    font-size: 24px;            /* 圖示縮小 */
    margin-bottom: 4px;         /* 圖示與文字間距縮小 */
  }

  .btn-circle span {
    font-size: 16px;            /* 文字縮小 */
  }
}

    /* 🪟 所有模態框的基本設定（包含一般 modal、裝扮 costume-modal、復活 revive-modal） */
.modal, .costume-modal, .revive-modal {
    display: none;                          /* 預設隱藏，透過 JS 來顯示 */
    position: fixed;                        /* 固定在畫面上不會被捲動影響 */
    top: 0;
    left: 0;
    width: 100%;                            /* 全畫面寬度 */
    height: 100%;                           /* 全畫面高度 */
    background-color: rgba(0,0,0,0.5);      /* 背景為半透明黑色 */
    z-index: 1000;                          /* 層級很高，蓋住所有畫面 */
    justify-content: center;               /* 將裡面的內容水平置中 */
    align-items: center;                   /* 將裡面的內容垂直置中 */
}

/* ✍️ 所有文字輸入框的樣式（如命名、輸入指令等） */
input[type="text"] {
    font-size: 48px; /* 使用大字，適合觸控裝置輸入 */
}

/* 📦 所有模態框內部的內容區（即 modal-content） */
.modal-content {
    position: relative;                    /* 為了讓右上角關閉叉叉能相對定位 */
    background-color: white;              /* 背景為白色 */
    padding: 40px;                         /* 內距 */
    border-radius: 20px;                   /* 邊角圓弧 */
    width: 800px;                          /* 固定寬度為橫向長方形 */
    height: 600px;                         /* 固定高度，可容納內容 */
    overflow-y: auto;                      /* 若內容太多則可垂直滾動 */
    max-width: 90%;                        /* 手機寬度限制最大 90% */
    font-size: 48px;                       /* 內文大字體顯示 */
}


/* 🏷️ 名稱顯示區容器（寵物命名、玩家名稱） */
.name-container {
    display: flex;                         /* 讓內容橫向對齊 */
    align-items: center;                   /* 垂直置中對齊 */
    justify-content: center;               /* 水平置中對齊 */
}



/* 🔴 按鈕提示動畫（會外框閃爍吸引注意） */
@keyframes buttonPulse {
    0%   { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }  /* 初始：紅色陰影內縮 */
    70%  { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } /* 擴大陰影變透明 */
    100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }    /* 回到初始 */
}

/* 🔴 讓按鈕有閃爍提示效果的類別 */
.pulse-button {
    animation: buttonPulse 2s infinite;    /* 每兩秒閃爍一次 */
}

/* 🌧️ 閃電特效 */
.lightning-flash {
  position: absolute;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: white;
  opacity: 0.8;
  z-index: 1000;
  transition: opacity 0.2s ease-out;
  pointer-events: none; /* 不阻擋點擊 */
}


/* 🌧️ 雨滴動畫單一雨滴設定（位置、外觀、動畫） */
.raindrop {
    position: absolute;                   /* 每滴雨是絕對定位 */
    top: 0;                               /* 從畫面最上方開始下 */

    /* ✅ 外觀設定 */
    width: 12px;                           /* 雨滴寬度（變粗） */
    height: 20px;                         /* 雨滴高度（變長） */
     background-color: rgba(255, 255, 255, 0.25); /* ✅ 白色 + 25% 透明 */
     
    /* ✅ 執行下落動畫（下到畫面底部） */
    animation: rainFall 0.6s linear infinite;
}

/* 🌧️ 雨滴動畫關鍵影格：往下落到底 */
@keyframes rainFall {
    to {
        transform: translateY(100vh);     /* 雨滴落到底部 */
    }
}


/* ✅ 雨滴動畫：往下移動畫面高度 */
@keyframes rainFall {
    to {
        transform: translateY(100vh);
    }
}
/* ⭐ 夜晚星星動畫（閃爍） */
.star {
  position: absolute;             /* 每一顆星星都是絕對定位 */
  width: 12px;                     /* 星星寬度 */
  height: 8px;                    /* 星星高度 */
  background-color: white;        /* 白色星星 */
  border-radius: 50%;             /* 圓形 */
  opacity: 0.8;                   /* 初始透明度 */
  animation: twinkle 2s infinite ease-in-out; /* 加入閃爍動畫 */
}

/* ⭐ 星星閃爍動畫關鍵影格 */
@keyframes twinkle {
  0%, 100% { opacity: 0.3; }      /* 閃爍：淡出 */
  50% { opacity: 1; }             /* 閃爍：最亮 */
}

/* ⭐ 星星容器只在畫面上半部顯示 */
#starsContainer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;                  /* 滿版寬度 */
  height: 50vh;                 /* 只佔螢幕上半部 */
  overflow: hidden;             /* 超出部分不顯示 */
  pointer-events: none;         /* 不擋住點擊操作 */
  z-index: 1;                   /* 顯示在背景圖上層、角色下層 */
}

/* 🌙 月亮圖示（置中顯示在螢幕上方） */
#moon {
  position: absolute;
  top: 200px;                     /* 離上方一段距離 */
  left: 50%;                     /* 從中間開始 */
  transform: translateX(-50%);   /* 置中對齊 */
  width: 240px;
  height: 240px;
  background-image: url('https://i.imgur.com/Ds6mk6p.png'); /* 可換你喜歡的月亮圖 */
  background-size: contain;
  background-repeat: no-repeat;
  z-index: 2;                    /* 顯示在星星之上 */
  opacity: 0.9;
}

 /* ======================================
🔹 底部控制按鈕樣式（聊天室 / 日誌）
====================================== */
#toggle-log-btn,
#chat-toggle-btn {
  width: 100%;
  color: white;
  font-size: 60px;
  padding: 24px 0;
  border: none;
  border-radius: 0;
  box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
}

#toggle-log-btn {
  background-color: #3b82f6; /* 藍色 */
}

#chat-toggle-btn {
  background-color: #ec4899; /* 粉紅 */
}

/* ======================================
📋 日誌抽屜樣式
====================================== */
#log-drawer {
  position: fixed;
  bottom: -100%;
  left: 0;
  width: 100%;
  height: 300px;
  background-color: rgba(255,255,255,0.95);
  transition: bottom 0.3s ease;
  z-index: 9999;
  padding: 20px;
  overflow-y: auto;
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
}

body.log-open #log-drawer {
  bottom: 120px; /* 顯示在畫面底部上方，避免遮住按鈕 */
}

body.log-open .bg-white.rounded-xl {
  margin-bottom: 320px; /* 推開主內容 */
}

/* ======================================
💬 聊天室抽屜樣式
====================================== */
/* 💬 聊天室抽屜（預設隱藏） */
#chat-panel {
  position: fixed;
  bottom: 0;
  right: 0;
  width: 100%;
  height:500px;
  background-color: rgb(255, 255, 255);
  transform: translateY(100%);
  transition: transform 0.1s ease-in-out;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  padding: 0; /* 改成 0 比較方便彈性控制 */
  border-top-left-radius: 20px;
  border-top-right-radius: 20px;
}
#close-chat-btn {
  position: absolute;
  top: 5px;
  right: 20px;
  background: none;
  border: none;
  font-size: 60px;
  cursor: pointer;
  z-index: 1001;
}
body.chat-open #chat-panel {
  transform: translateY(0px); /* 避開底部的兩個大按鈕 */
}

/* 聊天訊息容器（可捲動） */
#chat-messages {
  flex: 1;
  padding: 20px;
  font-size: 36px;
  overflow-y: auto;
}

/* 聊天輸入區塊（固定在下方） */
#chat-input-area {
  display: flex;
  gap: 10px;
  padding: 12px 20px;
  border-top: 1px solid #ccc;
  background: white;
}

#chat-input {
  flex: 1;
  font-size: 42px;
  padding: 12px;
}

#send-btn {
  font-size: 42px;
  padding: 24px 24px;
}


/* 🔴 日誌視窗內的重置按鈕 */
#reset-btn.reset-button {
  position: absolute;
  top: 12px;
  right: 20px;
  z-index: 10001;
  background-color: #ef4444;
  color: white;
  border: none;
  font-size: 40px;
  width: 100px;
  height: 100px;
  border-radius: 50%;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  cursor: pointer;
  transition: background-color 0.2s;
}
#reset-btn.reset-button:hover {
  background-color: #dc2626;
}


/* ✅ 探險模式啟動時，要隱藏的區塊（避免干擾畫面） */
body.exploring .status-panel,
body.exploring .info-panel,
body.exploring .button-wrapper,
body.exploring .control-panel,
body.exploring .lightning-flash,
body.exploring #weather-toggle,
body.exploring #moon,
body.exploring #starsContainer,
body.exploring #control-buttons,
body.exploring #rainContainer {
  display: none !important;
}

/* ✅ 探險時畫面上顯示「冒險中」的文字 */
#explore-label {
  position: absolute;
  top: 40px;                       /* 離上方距離 */
  left: 50%;
  transform: translateX(-50%);     /* 水平置中 */
  font-size: 60px;                 /* 字體夠大，讓玩家看清楚 */
  font-weight: bold;
  color: white;
  text-shadow: 2px 2px 4px black;  /* 加黑色陰影，避免白字難看清 */
  z-index: 50;
  display: none;                   /* 初始隱藏，進入探險時才顯示 */
}

/* ✅ 當 body 加上 exploring 時，顯示 explore-label */
body.exploring #explore-label {
  display: block;
}

/* ✅ 探險中時隱藏日誌按鈕群（避免干擾） */
body.exploring #log-controls #chat-button-container {
  display: none !important;
}

/* ✅ 探險模式中的「結束探險」按鈕樣式（畫面底部置中） */
#end-explore-btn {
  display: none;                   /* 預設隱藏 */
  position: fixed;
  bottom: 80px;                    /* 距離畫面底部 80px */
  left: 50%;
  transform: translateX(-50%);     /* 水平置中 */
  font-size: 60px;                 /* 按鈕文字夠大 */
  padding: 24px 40px;              /* 按鈕大小適中 */
  background-color: #ef4444;        /* 紅色背景 */
  color: white;
  border: none;
  border-radius: 16px;
  z-index: 10000;                  /* 極高層級，永遠在最上方 */
}

/* ✅ 探險中時顯示結束按鈕 */
body.exploring #end-explore-btn {
  display: block;
}

</style>
<!-- 🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨 CSS 樣式區塊 END 🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨 -->

</head>



<body class="h-screen w-screen overflow-hidden m-0 p-0">


  <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
  <div class="bg-white p-6 rounded-lg shadow-md w-96">
    <h2 class="text-xl font-bold mb-4">登入遊戲</h2>
    <input type="text" id="player-id-input" class="w-full p-2 border border-gray-300 rounded mb-4" placeholder="請輸入你的玩家帳號">
    <button id="login-btn" class="w-full bg-blue-500 text-white py-2 rounded">登入</button>
  </div>
</div>

<!-- 🐣 選擇寵物模態框 -->
<div id="choose-pet-modal" class="modal">
  <div class="modal-content">
    <h2 class="text-xl font-bold mb-6">選擇你的初始寵物</h2>
    <div id="starter-pet-list" style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: center;"></div>
  </div>
</div>

<!-- 🎒 背包模態框 START -->
<div id="backpack-modal" class="modal">
  <div class="modal-content">
    <h2 class="text-xl font-bold mb-4">背包內容</h2>
    <div id="backpack-items" class="grid grid-cols-6 gap-4">
  <!-- 每行6格，共5行（共30格） -->
</div>
    <button onclick="closeBackpack()" class="close-button">
      <i class="fas fa-times"></i>
    </button>
  </div>
</div>
<!-- 🎒 背包模態框 END -->


<!-- 🧩🧩🧩🧩🧩🧩🧩🧩🧩🧩 命名模態框區塊 START 🧩🧩🧩🧩🧩🧩🧩🧩🧩🧩 -->
    <div id="name-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-xl font-bold mb-4">為你的寵物取個名字</h2>
            <input type="text" id="pet-name-input" class="w-full border border-gray-300 rounded p-2 mb-4" placeholder="輸入名字">
            <button id="confirm-name-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded w-full">確定</button>
        </div>
    </div>
    
<!-- 改名模態框 -->
    <div id="rename-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-xl font-bold mb-4">為你的寵物改名</h2>
            <input type="text" id="rename-input" class="w-full border border-gray-300 rounded p-2 mb-4" placeholder="輸入新名字">
            <button id="confirm-rename-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded w-full">確定</button>
        </div>
    </div>
    


<!-- 🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍 探險選單模態框 START 🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍 -->
<div id="explore-modal" class="modal">
  <div class="modal-content">
    <!-- ❌ 叉叉關閉按鈕 -->
   <button onclick="closeExploreModal()" class="close-button">
  <i class="fas fa-times"></i>
</button>

    <h2 class="text-xl font-bold mb-6">選擇探險地點</h2>
    <button class="bg-orange-400 hover:bg-orange-500 text-white px-6 py-3 rounded mb-4 w-full" onclick="startExploration('咕咕洞穴')">咕咕洞穴</button>
    <button class="bg-purple-400 hover:bg-purple-500 text-white px-6 py-3 rounded mb-4 w-full" onclick="startExploration('神秘洞穴')">神秘洞穴</button>
    <button class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded w-full" onclick="startExploration('黑暗森林')">黑暗森林</button>
  </div>
</div>
<!-- 🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍 探險選單模態框 END 🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍🌍 -->

<!-- 🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁 探險獎勵模態框🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁 -->
<div id="explore-reward-modal" class="modal">
  <div class="modal-content">
    <h2 class="text-xl font-bold mb-4">獲得物品</h2>
    <div id="reward-items" class="mb-4 text-4xl">...</div>
    <button onclick="confirmReward()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded w-full text-3xl">確定</button>
  </div>
</div>

<!-- ✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅ 日誌滑出容器 START✅✅✅✅✅✅✅✅✅✅✅✅✅✅ -->
<div id="log-drawer">
  <button id="reset-btn" class="reset-button"><i class="fas fa-sync-alt"></i></button>
  <div id="log" style="font-size: 32px; line-height: 1.5;">
    <p>愛你的寵物！</p>
  </div>
</div>
<!-- 💬 聊天室抽屜 -->
<div id="chat-panel">
  <!-- ❌ 關閉按鈕 -->
  <button id="close-chat-btn">×</button>
  <div id="chat-messages" style="flex: 1; overflow-y: auto;">
    <!-- 訊息內容 -->
    <p>系統：一起來尬聊！</p>
  </div>

  <div id="chat-input-area">
    <input type="text" id="chat-input" placeholder="輸入訊息..." />
    <button id="send-btn">送出</button>
  </div>
</div>




<!-- ✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅ 日誌滑出容器 END✅✅✅✅✅✅✅✅✅✅✅✅✅✅ -->

    <div class="bg-white rounded-xl shadow-lg p-4 w-full h-full relative">


<!-- 🌤️🌤️🌤️🌤️🌤️🌤️🌤️🌤️🌤️🌤️ 天氣切換按鈕 START 🌤️🌤️🌤️🌤️🌤️🌤️🌤️🌤️🌤️🌤️ -->
          <div class="name-container mb-4">
           
            
        </div>
 <!-- 🌤️🌤️🌤️🌤️🌤️🌤️🌤️🌤️🌤️🌤️ 天氣切換按鈕 END 🌤️🌤️🌤️🌤️🌤️🌤️🌤️🌤️🌤️🌤️ -->       
        
<div class="pet-area absolute top-0 left-0 w-full h-full z-0" id="pet-area">

  
  <!-- 🐤🐤🐤🐤🐤🐤🐤🐤🐤🐤 寵物顯示區塊 START 🐤🐤🐤🐤🐤🐤🐤🐤🐤🐤 -->
  <div id="chicken-container" class="chicken-container">
    <div id="speech-bubble" class="speech-bubble"></div>
    <div id="chicken" class="sprite"></div>
    <div id="zzz-container" class="absolute -top-6 left-1/2 transform -translate-x-1/2 hidden"></div>
  </div>
 <!-- 🐤🐤🐤🐤🐤🐤🐤🐤🐤🐤 寵物顯示區塊 END 🐤🐤🐤🐤🐤🐤🐤🐤🐤🐤 -->

  <!-- 🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟 探險文字與按鈕 🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟-->
  <div id="explore-label">冒險中...</div>
  <button id="end-explore-btn">結束探險</button>

  <!-- 🌙 / ⭐ / 🌧️ / 💩 -->
  <div id="moon"></div>
  <div id="starsContainer"></div>
  <div id="rainContainer"></div>
  <div id="poop-container"></div>

</div>

  <!-- 🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢 左上角色資訊🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢 -->
  <!-- 左上角橢圓資訊欄 -->
<div class="info-panel">

  <!-- 左：等級圓環 -->
  <div class="level-circle">
    <svg viewBox="0 0 36 36" class="level-circle-svg">
      <path class="bg" d="M18 2.0845a15.9155 15.9155 0 1 1 0 31.831a15.9155 15.9155 0 1 1 0 -31.831"/>
      <path id="exp-ring" class="progress" d="M18 2.0845a15.9155 15.9155 0 1 1 0 31.831a15.9155 15.9155 0 1 1 0 -31.831"/>
      <g class="level-label">
        <text class="level-text" x="18" y="13" text-anchor="middle">Lv</text>
        <text class="level-number" x="18" y="24" text-anchor="middle" id="level">1</text>
      </g>
    </svg>
  </div>

  <!-- 中：名字、狀態、金幣 -->
  <div class="center-info">
    <div class="name-row">
      <h2 id="pet-name-display">未命名</h2>
      <button id="rename-btn"><i class="fas fa-pen"></i></button>
    </div>
    <div class="status-row"><span id="status">😊 狀態良好</span>
    </div>
  </div>

  <!-- 右：金幣 -->
  <div class="coin-box">
    <span id="coins">0</span>
    <i class="fas fa-coins"></i>
  </div>

  <!-- 狀態圓圈 -->
<div class="status-circles flex items-center justify-end"> <!-- 加上 justify-end 讓整體靠右 -->

  <!-- 飢餓 -->
  <div class="circle-wrapper hunger">
    <svg class="circle-svg" viewBox="0 0 100 100">
      <circle class="circle-bg" cx="50" cy="50" r="45" />
      <circle id="hunger-bar" class="circle-bar" cx="50" cy="50" r="45" />
      <text x="50" y="55" text-anchor="middle" class="circle-title">飢餓</text>
    </svg>
    <div id="hunger-value" class="status-value">100%</div>
  </div>

  <!-- 快樂 -->
  <div class="circle-wrapper happiness">
    <svg class="circle-svg" viewBox="0 0 100 100">
      <circle class="circle-bg" cx="50" cy="50" r="45" />
      <circle id="happiness-bar" class="circle-bar" cx="50" cy="50" r="45" />
      <text x="50" y="55" text-anchor="middle" class="circle-title">快樂</text>
    </svg>
    <div id="happiness-value" class="status-value">100%</div>
  </div>

  <!-- 精力 -->
  <div class="circle-wrapper energy">
    <svg class="circle-svg" viewBox="0 0 100 100">
      <circle class="circle-bg" cx="50" cy="50" r="45" />
      <circle id="energy-bar" class="circle-bar" cx="50" cy="50" r="45" />
      <text x="50" y="55" text-anchor="middle" class="circle-title">精力</text>
    </svg>
    <div id="energy-value" class="status-value">100%</div>
  </div>

  <!-- 清潔 -->
  <div class="circle-wrapper cleanliness">
    <svg class="circle-svg" viewBox="0 0 100 100">
      <circle class="circle-bg" cx="50" cy="50" r="45" />
      <circle id="cleanliness-bar" class="circle-bar" cx="50" cy="50" r="45" />
      <text x="50" y="55" text-anchor="middle" class="circle-title">清潔</text>
    </svg>
    <div id="cleanliness-value" class="status-value">100%</div>
  </div>
</div>
</div>

  <!-- 下方天氣按鈕 -->
  <div id="weather-toggle">
    <i id="weather-icon" class="fas fa-sun"></i>
  </div>

<!-- 🟠🟠🟠🟠🟠🟠🟠🟠🟠🟠 按鈕功能區塊 START 🟠🟠🟠🟠🟠🟠🟠🟠🟠🟠 -->        
   <div class="button-wrapper">
  <div class="button-row">
    <button id="feed-btn" class="btn-circle bg-yellow-400 hover:bg-yellow-500">
  <i class="fas fa-utensils"></i>
  <span>餵食</span>
</button>

<button id="play-btn" class="btn-circle bg-blue-400 hover:bg-blue-500">
  <i class="fas fa-gamepad"></i>
  <span>玩耍</span>
</button>

<button id="clean-btn" class="btn-circle bg-green-400 hover:bg-green-500">
  <i class="fas fa-bath"></i>
  <span>清潔</span>
</button>

<button id="sleep-btn" class="btn-circle bg-purple-400 hover:bg-purple-500">
  <i class="fas fa-moon"></i>
  <span>睡覺</span>
</button>

 <button id="bag-btn" class="btn-circle bg-gray-400 hover:bg-gray-500">
      <i class="fas fa-box-open"></i>
      <span>背包</span>
    </button>

    <button id="explore-btn" class="btn-circle bg-orange-400 hover:bg-orange-500">
      <i class="fas fa-map-marked-alt"></i>
      <span>探險</span>
    </button>
<button id="evolve-btn" class="btn-circle bg-pink-400 hover:bg-pink-500">
  <i class="fas fa-dna"></i>
  <span>進化</span>
</button>
  </div>
</div>

<!-- 🟠🟠🟠🟠🟠🟠🟠🟠🟠🟠 按鈕功能區塊 END 🟠🟠🟠🟠🟠🟠🟠🟠🟠🟠 -->

<!-- 📦 底部共同控制區塊 -->
<!-- ✅ 包住按鈕的容器，這個 id 可以讓我們控制整塊一起隱藏 -->
<div id="control-buttons" class="fixed bottom-0 left-0 w-full flex z-50">
  <!-- 📋 查看日誌按鈕（左側 50%） -->
  <div class="w-1/2">
    <button id="toggle-log-btn" class="w-full bg-blue-500 btn-large">
      查看日誌
    </button>
  </div>

  <!-- 💬 聊天室按鈕（右側 50%） -->
  <div class="w-1/2">
    <button id="chat-toggle-btn" class="w-full bg-pink-500 btn-large">
      聊天室
    </button>
  </div>
</div>


 <!-- 🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠 JavaScript 遊戲邏輯區塊 START 🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠 -->
   <script>


 const apiKey = 'AIzaSyBYbCZQNBg5SJ5_msWws9sDok7fE2hPd20'; // 已插入你的 Gemini API 金鑰

async function sendMessage() {
  const input = document.getElementById('chat-input');
  const chatbox = document.getElementById('chat-messages');
  const userMsg = input.value.trim();
  if (!userMsg) return;

  chatbox.innerHTML += `<div class="msg user">你：${userMsg}</div>`;
  input.value = '';
  chatbox.scrollTop = chatbox.scrollHeight;

}

function showStarterPetModal() {
  const list = document.getElementById('starter-pet-list');
  list.innerHTML = ''; // 清空舊資料

  const starters = evolutionData.filter(e => parseInt(e.stage) === 1);
  starters.forEach(petOption => {
    const div = document.createElement('div');
    div.style.cursor = 'pointer';
    div.style.textAlign = 'center';

    const img = document.createElement('img');
    img.src = petOption.image;
    img.style.width = '150px';
    img.style.height = '150px';
    img.style.objectFit = 'contain';
    img.style.borderRadius = '16px';

   const name = document.createElement('div');
name.textContent = petOption["名子"] || petOption["角色名稱"];

    div.appendChild(img);
    div.appendChild(name);

    div.addEventListener('click', () => {
      pet.spriteName = petOption.name;
      pet.stage = parseInt(petOption.stage);
      document.getElementById('choose-pet-modal').style.display = 'none';
      showNameModal(); // 選完後顯示命名視窗
      updateChickenSprite(); // 顯示選到的角色
    });

    list.appendChild(div);
  });

  document.getElementById('choose-pet-modal').style.display = 'flex';
}



// 🔄🔄🔄🔄🔄 初始化遊戲邏輯主流程 START 🔄🔄🔄🔄🔄
        function initPet() {
            // 嘗試從localStorage加載保存的遊戲
            loadGame();
            
            // 如果沒有名字，顯示選擇寵物模態框 → 再命名
if (!pet.name) {
    showStarterPetModal();  // 這是選寵物的視窗
} else {
    updateNameDisplay();
}

            updateChickenSprite(); // ✅ 初始化時讀取角色圖片
            updateStatusBars();
            updateSleepButton();

            autoSetWeatherByTime();  // ✅ 插在這邊
            
            // 設置計時器
           setInterval(updatePetStatus, 1000); // 每 1 秒更新一次狀態（飢餓、快樂、精力等變化）
           setInterval(autoMove, 1000);// 每 1秒自動走動一次
           setInterval(autoAction, 3000); // 每 3 秒檢查是否執行行為（自動吃、玩、睡）
           setInterval(checkNeeds, 3000); // 每 3 秒檢查是否需要提示需求（餓、髒、無聊）
           setInterval(poop, 300000);    // 每 60秒可能會大便一次
           setInterval(saveGame, 30000);  // 每 30 秒自動存檔
           setInterval(autoSetWeatherByTime, 3600000);   // 每 1 小時依時間變換天氣
            
            // 添加事件監聽器
            feedBtn.addEventListener('click', feedPet);
            playBtn.addEventListener('click', playWithPet);
            cleanBtn.addEventListener('click', cleanPet);
            sleepBtn.addEventListener('click', toggleSleep);
            confirmNameBtn.addEventListener('click', confirmName);
            confirmRenameBtn.addEventListener('click', confirmRename);
            renameBtn.addEventListener('click', showRenameModal);
 
      
document.getElementById('evolve-btn').addEventListener('click', () => {
  if (!evolutionData || evolutionData.length === 0) {
    alert("進化資料尚未載入完成，請稍後再試！");
    return;
  }

 checkEvolution();       // ✅ 只有按按鈕才觸發進化
  updateChickenSprite();
});
    
            document.getElementById('weather-btn').addEventListener('click', () => {
    const weathers = ['sunny', 'rainy', 'hot', 'night'];
    pet.weather = weathers[Math.floor(Math.random() * weathers.length)];
    updateWeather();
});
            
            // 初始位置
            const areaWidth = petArea.clientWidth;
            const areaHeight = petArea.clientHeight;
            pet.position.x = areaWidth / 2;
            pet.position.y = areaHeight / 2;
            updatePosition();
            
            if (pet.growthStage === 0) {
                addLog(`${pet.name}已經在線上啦！`);
            } else {
                addLog(`${pet.name}回來了！`);
            }
        }
// 🔄🔄🔄🔄🔄 初始化遊戲主流程 END 🔄🔄🔄🔄🔄

// 🐣🐣🐣🐣🐣🐣🐣🐣🐣🐣 寵物狀態資料區 START 🐣🐣🐣🐣🐣🐣🐣🐣🐣🐣
const pet = {
  name: "",                  // 🐤 寵物的名字（命名與顯示用）
  spriteName: "gugu_egg",
  level: 1,                  // 📈 等級（每7天升級一次，用於進化與難度調整）
  exp: 0,        // 從 0 開始
  maxExp: 100,   // 每級所需經驗
  stage: 1,               
  hunger: 100,               // 🍽️ 飢餓度（自動吃飯或需餵食）
  happiness: 100,           // 🎮 快樂度（與玩具或互動影響）
  energy: 100,              // 💤 精力（影響睡覺邏輯）
  cleanliness: 100,         // 🧼 清潔度（拉屎後會下降）
  isSleeping: false,        // 😴 是否正在睡覺
  isEating: false,          // 🍽️ 是否正在吃東西
  isPlaying: false,         // 🎲 是否正在玩耍
  position: { x: 0, y: 0 }, // 📍 當前座標位置（移動動畫與 autoMove 用）
  direction: 1,             // ➡️ 移動方向（1: 向右，-1: 向左）
  mood: 'happy',            // 😀 心情狀態（未使用，但可用於額外行為邏輯）
  lastActionTime: Date.now(),           // ⏱️ 上次自動行為的時間（如 autoAction）
  lastHungerDecrease: Date.now(),       // ⏱️ 上次飢餓下降時間
  lastHappinessDecrease: Date.now(),    // ⏱️ 上次快樂下降時間
  lastEnergyDecrease: Date.now(),       // ⏱️ 上次精力變動時間
  lastCleanlinessDecrease: Date.now(),  // ⏱️ 上次清潔度下降時間
  lastAgeIncrease: Date.now(),          // ⏱️ 上次年齡成長時間
  lastPoopTime: Date.now(),             // ⏱️ 上次大便時間
  lastSaveTime: Date.now(),             // 💾 上次存檔時間（判斷離線時間差）
  weather: 'sunny'          // 🌤️ 當前天氣狀態（sunny/rainy/hot/night）
};
let lastTalkTime = 0;
const talkCooldown = 5000; // 每 5 秒只能說話一次
     
// 🐣🐣🐣🐣🐣🐣🐣🐣🐣🐣 寵物狀態資料區 END 🐣🐣🐣🐣🐣🐣🐣🐣🐣🐣



// 📊📊📊📊📊 狀態條與 UI 顯示 START 📊📊📊📊📊
// 更新狀態條
        function updateStatusBars() {
  // 🔁 水平進度條更新（保留）
  hungerBar.style.width = `${pet.hunger}%`;
  happinessBar.style.width = `${pet.happiness}%`;
  energyBar.style.width = `${pet.energy}%`;
  cleanlinessBar.style.width = `${pet.cleanliness}%`;

  // ✅ 同步更新圓形條的百分比數字
  document.getElementById('hunger-value').textContent = `${pet.hunger}%`;
  document.getElementById('happiness-value').textContent = `${pet.happiness}%`;
  document.getElementById('energy-value').textContent = `${pet.energy}%`;
  document.getElementById('cleanliness-value').textContent = `${pet.cleanliness}%`;

  // ✅ 同步更新圓形條的 SVG 視覺進度
  setCircleProgress('hunger-bar', pet.hunger);
  setCircleProgress('happiness-bar', pet.happiness);
  setCircleProgress('energy-bar', pet.energy);
  setCircleProgress('cleanliness-bar', pet.cleanliness);

  // 等級顯示
  levelDisplay.textContent = pet.level;

  // 🧠 狀態文字邏輯
  if (document.body.classList.contains('exploring')) {
    statusDisplay.textContent = "🌲 探險中...";
    statusDisplay.className = "text-white font-bold";
    return;
  }

  if (pet.isSleeping) {
    statusDisplay.textContent = "😴 睡覺中";
    statusDisplay.className = "text-purple-600";
    randomTalk('sleeping');
  } else if (pet.isEating) {
    statusDisplay.textContent = "🍽️ 進食中";
    statusDisplay.className = "text-yellow-600";
    randomTalk('eating');
  } else if (pet.isPlaying) {
    statusDisplay.textContent = "🎮 玩耍中";
    statusDisplay.className = "text-blue-600";
    randomTalk('playing');
  } else if (pet.hunger < 30) {
    statusDisplay.textContent = "🍗 肚子好餓";
    statusDisplay.className = "text-red-500 font-bold";
    randomTalk('hungry');
  } else if (pet.energy < 30) {
    statusDisplay.textContent = "🥱 有點累";
    statusDisplay.className = "text-indigo-500 font-bold";
    randomTalk('tired');
  } else if (pet.happiness < 30) {
    statusDisplay.textContent = "😢 心情不好";
    statusDisplay.className = "text-gray-600 font-bold";
    randomTalk('bored');
  } else if (pet.cleanliness < 30) {
    statusDisplay.textContent = "🧼 髒兮兮";
    statusDisplay.className = "text-brown-500 font-bold";
    randomTalk('dirty');
  } else {
    statusDisplay.textContent = "😊 狀態良好";
    statusDisplay.className = "text-green-600";
    randomTalk('normal');
  }
  
}
function setCircleProgress(circleId, percent) {
  const circle = document.getElementById(circleId);
  const radius = 45;
  const circumference = 2 * Math.PI * radius;
  const offset = circumference * (1 - percent / 100);
  circle.style.strokeDasharray = `${circumference - offset} ${circumference}`;
}

        // 更新位置
        function updatePosition() {
  chickenContainer.style.left = `${pet.position.x}px`;
  chickenContainer.style.top = `${pet.position.y}px`;

   // 根據方向翻轉圖像
  if (pet.direction === -1) {
    chicken.style.transform = 'scaleX(-1)';
  } else {
    chicken.style.transform = 'scaleX(1)';
  }
}
// 📊📊📊📊📊 狀態條與 UI 顯示 END 📊📊📊📊📊


// ✏️✏️✏️✏️ 命名與改名功能 START ✏️✏️✏️✏️
        function updateNameDisplay() {
            if (pet.name) {
                petNameDisplay.textContent = pet.name;
            } else {
                petNameDisplay.textContent = "未命名";
            }
        }

        // 顯示命名模態框
        function showNameModal() {
            nameModal.style.display = 'flex';
            petNameInput.focus();
        }

        // 顯示改名模態框
        function showRenameModal() {
            if (pet.isDead) return;
            
            renameInput.value = pet.name;
            renameModal.style.display = 'flex';
            renameInput.focus();
        }

        // 確認名字
        function confirmName() {
  const name = petNameInput.value.trim();
  if (name) {
    pet.name = name;
    nameModal.style.display = 'none';
    updateNameDisplay();
    updateNameTag();
    addLog(`你將寵物命名為「${pet.name}」`);
    saveGame(); // ✅ 命名後馬上存檔
  } else {
    alert("請輸入一個有效的名字！");
  }
}
        // 確認改名
        function confirmRename() {
            const newName = renameInput.value.trim();
            if (newName) {
                const oldName = pet.name;
                pet.name = newName;
                renameModal.style.display = 'none';
                updateNameDisplay();
                updateNameTag();
                addLog(`你將寵物「${oldName}」改名為「${newName}」`);
                saveGame();
            } else {
                alert("請輸入一個有效的名字！");
            }
        }

      
// ✏️✏️✏️✏️ 命名與改名功能 END ✏️✏️✏️✏️

// 🌤️🌤️🌤️ 自動設定天氣（根據時間） START
function autoSetWeatherByTime() {
    const hour = new Date().getHours();

    if (hour >= 6 && hour < 18) {
        // 白天 → 隨機選擇 sunny / rainy / hot
        const dayWeathers = ['sunny', 'rainy', 'hot', 'storm'];
        pet.weather = dayWeathers[Math.floor(Math.random() * dayWeathers.length)];
    } else {
        // 晚上 → 固定 night
        pet.weather = 'night';
    }

    updateWeather();
}

// 🌤️🌤️🌤️🌤️🌤️🌤️自動設定天氣 END🌤️🌤️🌤️🌤️🌤️


// 🌤️🌤️🌤️🌤️ 天氣控制邏輯 START 🌤️🌤️🌤️🌤️
        function toggleWeather() {
    const weatherList = ['sunny', 'rainy', 'hot', 'storm', 'night'];
    const currentIndex = weatherList.indexOf(pet.weather);
    pet.weather = weatherList[(currentIndex + 1) % weatherList.length];

    

    updateWeather();
    addLog(`天氣變成了：${pet.weather}`);
    saveGame();
     // ✅ 根據新天氣呼叫不同的話語
  switch (pet.weather) {
    case 'sunny':
      randomTalk('weather_sunny');
      break;
    case 'rainy':
      randomTalk('weather_rainy');
      break;
    case 'hot':
      randomTalk('weather_hot');
      break;
      case 'storm':
    randomTalk('weather_storm');
    break;
    case 'night':
      randomTalk('weather_night');
      break;
  }
}
let lightningLoopInterval;


  function updateWeather() {
  petArea.style.backgroundImage = '';
  petArea.classList.remove('daytime', 'nighttime');

  document.getElementById('rainContainer').innerHTML = '';
  document.getElementById('starsContainer').innerHTML = '';
  document.querySelectorAll('.lightning-flash').forEach(flash => flash.remove());
  clearInterval(lightningLoopInterval);

  switch (pet.weather) {
    case 'sunny':
      petArea.style.backgroundImage = "url('https://i.imgur.com/qB5GmEI.png')";
      document.getElementById('weather-icon').className = "fas fa-cloud-sun text-yellow-500";
      break;
    case 'rainy':
      petArea.style.backgroundImage = "url('https://i.imgur.com/EKyxQMx.png')";
      document.getElementById('weather-icon').className = "fas fa-cloud-showers-heavy text-blue-500";
      createRainEffect();
      break;
    case 'hot':
      petArea.style.backgroundImage = "url('https://i.imgur.com/YrLNhPO.png')";
      document.getElementById('weather-icon').className = "fas fa-sun text-orange-500";
      break;
    case 'storm':
      petArea.style.backgroundImage = "url('https://i.imgur.com/uU3ed04.png')";
      document.getElementById('weather-icon').className = "fas fa-bolt text-purple-500";
      createRainEffect();
      createLightningEffect(2);
      lightningLoopInterval = setInterval(() => {
        const repeat = 2 + Math.floor(Math.random() * 2);
        createLightningEffect(repeat);
      }, 10000 + Math.random() * 5000);
      break;
    case 'night':
      petArea.style.backgroundImage = "url('https://i.imgur.com/UQS4dtr.png')";
      document.getElementById('weather-icon').className = "fas fa-moon text-yellow-500";
      createStars();
      break;
  }

  const moon = document.getElementById('moon');
  moon.style.display = pet.weather === 'night' ? 'block' : 'none';

  petArea.style.backgroundSize = 'cover';
  petArea.style.backgroundPosition = 'center';
}


function createLightningEffect(repeat = 3, delay = 300) {
  if (document.body.classList.contains('exploring')) return;

  let count = 0;
  const flashOnce = () => {
    const flash = document.createElement('div');
    flash.className = 'lightning-flash';
    document.body.appendChild(flash);

    setTimeout(() => {
      flash.style.opacity = '0';
      setTimeout(() => flash.remove(), 200);
    }, 100);

    count++;
    if (count < repeat) {
      setTimeout(flashOnce, delay + Math.random() * 200);
    }
  };

  flashOnce();
}




function createRainEffect() {
  const rainContainer = document.getElementById('rainContainer');
  rainContainer.innerHTML = ''; // ❗ 清掉之前的雨滴

  for (let i = 0; i < 50; i++) {
    const drop = document.createElement('div');
    drop.className = 'raindrop';
    drop.style.left = `${Math.random() * 100}%`;
    drop.style.animationDelay = `${Math.random() * 2}s`;
    rainContainer.appendChild(drop); // ✅ 加入正確容器
  }
}

function createStars() {
  const starsContainer = document.getElementById('starsContainer');
  starsContainer.innerHTML = ''; // 清除舊星星 ✅

  for (let i = 0; i < 80; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    star.style.top = `${Math.random() * 100}%`;
    star.style.left = `${Math.random() * 100}%`;
    star.style.animationDelay = `${Math.random() * 2}s`;
    starsContainer.appendChild(star);
  }
}
// 🌤️🌤️🌤️🌤️ 天氣控制邏輯 END 🌤️🌤️🌤️🌤️

// ✨✨✨✨✨ 自動行為控制 START ✨✨✨✨✨
      function autoMove() {
  if (pet.isSleeping || pet.isEating || pet.isPlaying || pet.isDead) return;

  const areaRect = petArea.getBoundingClientRect(); // 🟦 取得真正的可活動區域

  const marginX = 200;  // 左右安全邊距
  const leftLimit = areaRect.left + marginX;
  const rightLimit = areaRect.right - marginX;

  const topLimit = areaRect.top + 600; // 頂端 + 200 高度

  const buttonWrapper = document.querySelector('.button-wrapper');
  const buttonTop = buttonWrapper.getBoundingClientRect().top;
  const bottomLimit = buttonTop - 80;

  // 隨機是否要移動
  if (Math.random() > 0.3) {
    pet.direction = Math.random() > 0.5 ? 1 : -1;

    let newX = pet.position.x + (pet.direction * (20 + Math.random() * 30));
    let newY = pet.position.y + (Math.random() > 0.5 ? -10 : 10);

    // 限制 X, Y 不超出邊界
    newX = Math.max(leftLimit, Math.min(rightLimit, newX));
    newY = Math.max(topLimit, Math.min(bottomLimit, newY));

    pet.position.x = newX;
    pet.position.y = newY;

    // 動畫
    chicken.classList.add('walking');
    setTimeout(() => {
      chicken.classList.remove('walking');
    }, 500);

    updatePosition();

    if (Math.random() > 0.5) {
      randomTalk('walk');
    }
  }

  // ✅ 顯示框線 debug
  const moveRange = document.getElementById('move-range');
  if (moveRange) {
    moveRange.style.left = `${leftLimit}px`;
    moveRange.style.top = `${topLimit}px`;
    moveRange.style.width = `${rightLimit - leftLimit}px`;
    moveRange.style.height = `${bottomLimit - topLimit}px`;
  }
}

        function autoAction() {
    if (pet.isDead || pet.isEating || pet.isPlaying) return;

    const now = Date.now();

    // ✅ 若場上有食物且飢餓度不滿，優先走去吃
    const foodItems = document.querySelectorAll('.food-item');
    if (foodItems.length > 0 && pet.hunger < 90) {
        const food = foodItems[0];
        const foodName = food.title;

        pet.isEating = true;
        chicken.classList.add('eating');
        randomTalk('eating');

        // 模擬移動到食物位置
        const foodRect = food.getBoundingClientRect();
        const areaRect = petArea.getBoundingClientRect();
        pet.position.x = foodRect.left - areaRect.left + foodRect.width / 2;
        pet.position.y = foodRect.top - areaRect.top + foodRect.height / 2;
        updatePosition();

        setTimeout(() => {
            pet.hunger = Math.min(100, pet.hunger + 30);
            pet.isEating = false;
            chicken.classList.remove('eating');
            food.remove();
            addLog(`${pet.name}肚子餓，吃掉了${foodName}（+30）`);
            updateStatusBars();
            saveGame();
        }, 2000);
        return;
    }

    // ✅ 若場上有玩具且快樂度不滿，優先去玩
    const toyItems = document.querySelectorAll('.toy-item');
    if (toyItems.length > 0 && pet.happiness < 90) {
        const toy = toyItems[0];
        const toyName = toy.title;

        pet.isPlaying = true;
        chicken.classList.add('playing');
        randomTalk('playing');

        const toyRect = toy.getBoundingClientRect();
        const areaRect = petArea.getBoundingClientRect();
        pet.position.x = toyRect.left - areaRect.left + toyRect.width / 2;
        pet.position.y = toyRect.top - areaRect.top + toyRect.height / 2;
        updatePosition();

        setTimeout(() => {
            pet.happiness = Math.min(100, pet.happiness + 30);
            pet.energy = Math.max(0, pet.energy - 10);
            pet.cleanliness = Math.max(0, pet.cleanliness - 10);
            pet.hunger = Math.max(0, pet.hunger - 10);
            pet.isPlaying = false;
            chicken.classList.remove('playing');
            toy.remove();
            addLog(`${pet.name}自己玩了${toyName}（快樂+30、精力-10、清潔-10、飢餓-10）`);
            updateStatusBars();
            saveGame();
        }, 3000);
        return;
    }

    // 飢餓度低於 50 自動吃飯
    if (pet.hunger < 50 && !pet.isEating) {
        pet.isEating = true;
        chicken.classList.add('eating');
        randomTalk('eating');
        setTimeout(() => {
            pet.hunger = Math.min(100, pet.hunger + 30);
            pet.isEating = false;
            chicken.classList.remove('eating');
            addLog(`${pet.name}肚子餓，自動吃了飯（+30）`);
            updateStatusBars();
            saveGame();
        }, 2000);
        return;
    }

    // 快樂度低於 50 自動玩
    if (pet.happiness < 50 && !pet.isPlaying) {
        pet.isPlaying = true;
        chicken.classList.add('playing');
        randomTalk('playing');
        setTimeout(() => {
            pet.happiness = Math.min(100, pet.happiness + 30);
            pet.energy = Math.max(0, pet.energy - 10);
            pet.cleanliness = Math.max(0, pet.cleanliness - 10);
            pet.hunger = Math.max(0, pet.hunger - 10);
            pet.isPlaying = false;
            chicken.classList.remove('playing');
            addLog(`${pet.name}自己玩耍（快樂+30、精力-10、清潔-10、飢餓-10）`);
            updateStatusBars();
            saveGame();
        }, 3000);
        return;
    }

    // 精力低於 20 自動睡覺
    if (pet.energy < 20 && !pet.isSleeping) {
        pet.isSleeping = true;
        chicken.classList.add('sleeping');
        randomTalk('sleeping');
        startZzz();
        addLog(`${pet.name}太累了，自動睡覺`);
        return;
    }

    // 睡到 80 自動起床
    if (pet.isSleeping && pet.energy >= 80) {
        pet.isSleeping = false;
        chicken.classList.remove('sleeping');
        randomTalk('wake');
        clearZzz();
        pet.happiness = Math.min(100, pet.happiness + 5);
        pet.hunger = Math.max(0, pet.hunger - 5);
        addLog(`${pet.name}睡飽了，自動起床（快樂+5、飢餓-5）`);
        updateStatusBars();
        saveGame();
    }

    // 清潔度檢查與自動清潔
    if (pet.cleanliness < 50) {
        const cleanPenalty = Math.floor((50 - pet.cleanliness) / 5) * 5;
        pet.happiness = Math.max(0, pet.happiness - cleanPenalty);
        addLog(`${pet.name}太髒了，快樂度下降 ${cleanPenalty}`);

        if (pet.cleanliness < 30) {
            pet.cleanliness = 100;
            poopContainer.innerHTML = '';
            randomTalk('dirty');
            addLog(`${pet.name}太髒，自動清潔完畢`);
            updateStatusBars();
            saveGame();
        }
    }
}


        // 檢查需求（每 3 秒執行一次）
function checkNeeds() {
  if (pet.isDead) return;

  if (pet.hunger < 30) {
    if (Math.random() > 0.5) randomTalk('hungry');
  } else {
    pet.starvationTime = 0;
  }

  if (pet.happiness < 30) {
    if (Math.random() > 0.5) randomTalk('bored');
  }

  if (pet.cleanliness < 30) {
    if (Math.random() > 0.5) randomTalk('dirty');
  }
}

// ✨✨✨✨✨ 自動行為控制 END ✨✨✨✨✨

// 💩💩💩💩💩 大便行為邏輯 START 💩💩💩💩💩       
        // 大便
        function poop() {
            if (pet.isDead || pet.isSleeping || pet.growthStage === 0) return;
            
            // 20%機率大便
            if (Math.random() > 0.8) {
                const poopElement = document.createElement('div');
                poopElement.className = 'poop';
                
                // 寵物旁位置
                poopElement.style.left = `${pet.position.x + 50}px`; // 在寵物右邊一點
                poopElement.style.top = `${pet.position.y + 50}px`;  // 在寵物下方一點   
                
                poopContainer.appendChild(poopElement);
                
                // 清潔度下降20%
                pet.cleanliness = Math.max(0, pet.cleanliness - 20);
                updateStatusBars();
                
                addLog(`${pet.name}大便了，清潔度下降20%`);
                saveGame();
                
                // 10秒後自動消失
                setTimeout(() => {
                    if (poopElement.parentNode) {
                        poopElement.remove();
                    }
                }, 10000);
            }
        }

// 💩💩💩💩💩 大便行為邏輯 END 💩💩💩💩💩

// 🎁🎁🎁🎁🎁 食物與玩具生成 START 🎁🎁🎁🎁🎁
// 生成食物
        function spawnFood() {
            // 清除現有食物
            document.querySelectorAll('.food-item').forEach(item => item.remove());
            
            // 隨機生成1-3個食物
            const foodCount = 1 + Math.floor(Math.random() * 2);
            
            for (let i = 0; i < foodCount; i++) {
                const food = foods[Math.floor(Math.random() * foods.length)];
                const foodItem = document.createElement('div');
                foodItem.className = `food-item ${food.color} rounded-full flex items-center justify-center text-xl`;
                foodItem.textContent = food.emoji;
                foodItem.title = food.name;
                
                // 隨機位置
                const areaWidth = petArea.clientWidth;
                const areaHeight = petArea.clientHeight;
                const x = 30 + Math.random() * (areaWidth - 60);
                const y = 30 + Math.random() * (areaHeight - 90);
                
                foodItem.style.left = `${x}px`;
                foodItem.style.top = `${y}px`;
                
                // 點擊事件
                foodItem.addEventListener('click', () => {
                    if (pet.isDead) return;
                    
                    pet.hunger = Math.min(100, pet.hunger + food.restore);
                    updateStatusBars();
                    randomTalk('eating')
                    foodItem.remove();
                    addLog(`${pet.name}吃了${food.name}`);
                    saveGame();
                });
                
                petArea.appendChild(foodItem);
            }
        }

        // 生成玩具
        function spawnToy() {
            // 清除現有玩具
            document.querySelectorAll('.toy-item').forEach(item => item.remove());
            
            // 隨機生成1個玩具
            const toy = toys[Math.floor(Math.random() * toys.length)];
            const toyItem = document.createElement('div');
            toyItem.className = `toy-item ${toy.color} rounded-full flex items-center justify-center text-xl`;
            toyItem.textContent = toy.emoji;
            toyItem.title = toy.name;
            
            // 隨機位置
            const areaWidth = petArea.clientWidth;
            const areaHeight = petArea.clientHeight;
            const x = 30 + Math.random() * (areaWidth - 60);
            const y = 30 + Math.random() * (areaHeight - 90);
            
            toyItem.style.left = `${x}px`;
            toyItem.style.top = `${y}px`;
            
            // 點擊事件
            toyItem.addEventListener('click', () => {
                if (pet.isDead) return;
                
                pet.happiness = Math.min(100, pet.happiness + toy.restore);
                pet.energy = Math.max(0, pet.energy - 5);
                updateStatusBars();
               randomTalk('playing');
                toyItem.remove();
                addLog(`${pet.name}玩了${toy.name}`);
                saveGame();
            });
            
            petArea.appendChild(toyItem);
        }
// 🎁🎁🎁🎁🎁 食物與玩具生成 END 🎁🎁🎁🎁🎁

// 🍽️🍽️🍽️🍽️ 食物 / 玩具 / 造型資料定義區 START 🍽️🍽️🍽️🍽️
        const foods = [
            { name: '玉米', emoji: '🌽', color: 'bg-yellow-200', restore: 20 },
            { name: '蟲子', emoji: '🐛', color: 'bg-green-200', restore: 15 },
            { name: '種子', emoji: '🌱', color: 'bg-brown-200', restore: 10 }
        ];

        const toys = [
            { name: '球', emoji: '⚽', color: 'bg-red-200', restore: 15 },
            { name: '鈴鐺', emoji: '🔔', color: 'bg-yellow-200', restore: 10 },
            { name: '羽毛', emoji: '🪶', color: 'bg-white', restore: 20 }
        ];
        // 🎒 探險獎勵背包邏輯
let backpack = {};  // 背包資料，例如 { "羽毛": 2, "骨頭": 1 }
const dropTable = {
  '咕咕洞穴': ['羽毛', '種子', '蛋殼'],
  '神秘洞穴': ['水晶', '靈魂石', '毒菇'],
  '黑暗森林': ['骨頭', '黑羽', '詛咒種子']
};

// 🍽️🍽️🍽️🍽️ 食物 / 玩具 / 造型資料定義區 END 🍽️🍽️🍽️🍽️

function showSpeechBubble(text) {


  speechBubble.textContent = text;
  speechBubble.style.opacity = '1';

  // 計算氣泡寬度與螢幕限制
  setTimeout(() => {
    const bubbleRect = speechBubble.getBoundingClientRect();
    const containerRect = chickenContainer.getBoundingClientRect();
    const screenWidth = window.innerWidth;

    // 氣泡超出左邊界
    if (bubbleRect.left < 10) {
      const offset = 10 - bubbleRect.left;
      speechBubble.style.left = `calc(50% + ${offset}px)`;
    }

    // 氣泡超出右邊界
    if (bubbleRect.right > screenWidth - 10) {
      const offset = bubbleRect.right - (screenWidth - 10);
      speechBubble.style.left = `calc(50% - ${offset}px)`;
    }
  }, 10);  // 等待 DOM 更新位置後再判斷

  setTimeout(() => {
    speechBubble.style.opacity = '0';
    speechBubble.style.left = '50%';  // 回到原始置中狀態
  }, 5000);
}

 async function randomTalk(type) {

  const now = Date.now();
  if (now - lastTalkTime < talkCooldown) return;
  lastTalkTime = now;

  try {
    const characterName = pet.spriteName;
    const promptUrl = "https://script.google.com/macros/s/AKfycbwqwRG4dE2luydPA5osamt3AMhoh2zNhuOOkXw-fiGj-QR2SDzxK5M_4FP5kDjlti8l/exec?action=getPrompt&name=" + characterName;
    
    const promptRes = await fetch(promptUrl);
    const promptData = await promptRes.json();
    const personalityPrompt = promptData.prompt || "你是一隻電子寵物，請根據情境說一句話：";
   

    // 根據當下狀態給 Gemini 題目
    const statusMap = {
      hungry: "你現在肚子很餓。",
      tired: "你覺得有點累。",
      playing: "你正在玩耍。",
      eating: "你正在吃東西。",
      sleeping: "你在睡覺。",
      wake: "你剛醒來。",
      bored: "你覺得有點無聊。",
      dirty: "你覺得身上髒髒的。",
      normal: "你目前感覺很好。",
      walk: "你正在自由走動。",
      explore: "你正在冒險探索。",
     };
    const statusText = statusMap[type] || "請你說一句話。";

    // 天氣描述
    const weatherMap = {
      sunny: "現在是晴天，陽光普照。",
      rainy: "外面正在下雨。",
      hot: "天氣很炎熱。",
      storm:"打雷啦，有點怕。",
      night: "現在是晚上，天色昏暗。"
    };
    const weatherText = weatherMap[pet.weather] || "";

    // 組合最終描述
    const situation = `${statusText}${weatherText}`;

    const bodyData = {
      contents: [
        {
          parts: [
            { text: personalityPrompt },
            { text: "情境描述：" + situation }
          ]
        }
      ]
    };

    const geminiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=" + apiKey;
    const response = await fetch(geminiUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(bodyData)
    });

    const data = await response.json();
    const reply = data.candidates?.[0]?.content?.parts?.[0]?.text;

    if (reply) {
      showSpeechBubble(reply);
    } else {
      throw new Error("Gemini 回傳空值");
    }

  } catch (err) {
    console.warn("⚠️ Gemini 失敗，改用試算表資料：", err);

    // ✅ 備援機制：抓試算表裡的對話內容
    if (petSpeech[type] && petSpeech[type].length > 0) {
      const fallbackMsg = petSpeech[type][Math.floor(Math.random() * petSpeech[type].length)];
      showSpeechBubble(fallbackMsg);
    } else {
      showSpeechBubble("......（沉默）");
    }
  }
}



function checkEvolution() {
  const possibleEvolutions = evolutionData.filter(evo =>
    evo.evolve_from === pet.spriteName &&
    !isNaN(parseInt(evo.level)) &&
    pet.level >= parseInt(evo.level)
  );

  if (possibleEvolutions.length > 0) {
    let total = 0;
    const weightedList = [];

    for (let evo of possibleEvolutions) {
      const weight = parseFloat(evo.chance) || 0;
      total += weight;
      weightedList.push({ evo, weight: total });
    }

    const rand = Math.random() * total;
    const selected = weightedList.find(e => rand < e.weight).evo;

    // ✅ 執行進化
    pet.spriteName = selected.name;
    pet.stage = parseInt(selected.stage);
    chicken.style.backgroundImage = `url('${selected.image}')`;
    addLog(`角色進化為：${selected.name}`);
    saveGame();
  }
}


function updateChickenSprite() {
  if (!evolutionData || evolutionData.length === 0) {
    console.warn("⚠️ 無法更新角色圖片：evolutionData 尚未載入");
    return;
  }

  const matched = evolutionData.find(evo => evo.name === pet.spriteName);
  if (matched && matched.image) {
    chicken.style.backgroundImage = `url('${matched.image}')`;
  } else {
    chicken.style.backgroundImage = `url('https://i.imgur.com/oxsoI8H.png')`; // 預設蛋圖
  }
}



function pickEvolutionByChance(evolutions) {
  let total = 0;
  const weighted = [];

  for (let evo of evolutions) {
    const weight = parseFloat(evo["chance"]) || 0;
    total += weight;
    weighted.push({ evo, weight: total });
  }

  const rand = Math.random() * total;
  return weighted.find(e => rand < e.weight).evo;
}







// 📦📦📦📦📦 DOM 元素快取區 START 📦📦📦📦📦
        // 🐔 角色相關元素
const chickenContainer = document.getElementById('chicken-container'); // 包裹雞的整體容器（用於移動定位）
const chicken = document.getElementById('chicken'); // 實際顯示雞的圖像元素

// 💬 對話泡泡
const speechBubble = document.getElementById('speech-bubble'); // 顯示對話內容的泡泡

// 🏞️ 遊戲區域與背景
const petArea = document.getElementById('pet-area'); // 寵物活動的主區域（背景）

// 📊 狀態條區塊
const hungerBar = document.getElementById('hunger-bar'); // 飢餓度條
const happinessBar = document.getElementById('happiness-bar'); // 快樂度條
const energyBar = document.getElementById('energy-bar'); // 精力度條
const cleanlinessBar = document.getElementById('cleanliness-bar'); // 清潔度條

// 📈 狀態條數值顯示
const hungerValue = document.getElementById('hunger-value'); // 飢餓數值
const happinessValue = document.getElementById('happiness-value'); // 快樂數值
const energyValue = document.getElementById('energy-value'); // 精力數值
const cleanlinessValue = document.getElementById('cleanliness-value'); // 清潔數值

// 🧬 等級與年齡顯示
const levelDisplay = document.getElementById('level'); // 等級顯示
const statusDisplay = document.getElementById('status'); // 當前狀態（如睡覺中等）

// 📜 遊戲日誌
const log = document.getElementById('log'); // 顯示遊戲歷程記錄的區塊

// 🍽️ 按鈕操作：互動功能
const feedBtn = document.getElementById('feed-btn'); // 餵食按鈕
const playBtn = document.getElementById('play-btn'); // 玩耍按鈕
const cleanBtn = document.getElementById('clean-btn'); // 清潔按鈕
const sleepBtn = document.getElementById('sleep-btn'); // 睡覺按鈕
const renameBtn = document.getElementById('rename-btn'); // 改名按鈕
const logDrawer = document.getElementById('log-drawer');
const logControls = document.getElementById('log-controls');

// 點擊查看日誌按鈕，切換 log-open 狀態
document.getElementById('toggle-log-btn').addEventListener('click', () => {
  document.body.classList.toggle('log-open');
  document.body.classList.remove('chat-open'); // 確保聊天室關閉
});

// 點擊聊天室按鈕，切換 chat-open 狀態
document.getElementById('chat-toggle-btn').addEventListener('click', () => {
  document.body.classList.toggle('chat-open');
  document.body.classList.remove('log-open'); // 確保日誌關閉
});

// 📌 點擊聊天室內的「X 按鈕」，關閉聊天室視窗
document.getElementById("close-chat-btn").addEventListener("click", () => {
  // ➖ 關閉聊天室，只需移除 chat-open class
  document.body.classList.remove("chat-open");
});

document.getElementById('send-btn').addEventListener('click', async function () {
  const input = document.getElementById('chat-input');
  const msg = input.value.trim();
  if (!msg) return;

  const chatBox = document.getElementById('chat-messages');
  chatBox.innerHTML += `<p>你：${msg}</p>`;
  input.value = '';
  chatBox.scrollTop = chatBox.scrollHeight;

  const thinking = document.createElement('p');
  thinking.textContent = `寵物：思考中...`;
  chatBox.appendChild(thinking);
  chatBox.scrollTop = chatBox.scrollHeight;

  try {
    const characterName = pet.spriteName; // 可以改成變數 later
    const promptUrl = "https://script.google.com/macros/s/AKfycbwqwRG4dE2luydPA5osamt3AMhoh2zNhuOOkXw-fiGj-QR2SDzxK5M_4FP5kDjlti8l/exec?action=getPrompt&name=" + characterName;

    const promptRes = await fetch(promptUrl);
    const promptData = await promptRes.json();
    const petPrompt = promptData.prompt || "你是一隻友善的電子寵物，請回答以下訊息：";

    const geminiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=" + apiKey;

    const bodyData = {
      contents: [
        {
          parts: [
            { text: petPrompt },
            { text: "玩家說：" + msg }
          ]
        }
      ]
    };

    const response = await fetch(geminiUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(bodyData)
    });

    const data = await response.json();
    thinking.remove();

    const petReply = data.candidates?.[0]?.content?.parts?.[0]?.text || '嗯？我剛剛打瞌睡了...再說一次好嗎？';
    chatBox.innerHTML += `<p>寵物：${petReply}</p>`;
    chatBox.scrollTop = chatBox.scrollHeight;

  } catch (error) {
    thinking.remove();
    chatBox.innerHTML += `<p style="color:red">❌ 發送失敗：${error.message}</p>`;
    chatBox.scrollTop = chatBox.scrollHeight;
  }
});




// 💤 睡覺動畫
const zzzContainer = document.getElementById('zzz-container'); // 存放 ZZZ 動畫的小容器

// 💩 大便容器
const poopContainer = document.getElementById('poop-container'); // 存放寵物大便的容器

const petNameDisplay = document.getElementById('pet-name-display'); // 主介面上顯示的寵物名稱

// ✏️ 命名/改名模態框
const nameModal = document.getElementById('name-modal'); // 命名視窗
const renameModal = document.getElementById('rename-modal'); // 改名視窗
const petNameInput = document.getElementById('pet-name-input'); // 命名輸入框
const renameInput = document.getElementById('rename-input'); // 改名輸入框
const confirmNameBtn = document.getElementById('confirm-name-btn'); // 確認命名按鈕
const confirmRenameBtn = document.getElementById('confirm-rename-btn'); // 確認改名按鈕


// 📦📦📦📦📦 DOM 元素快取區 END 📦📦📦📦📦

function fetchPlayerRecord(playerId) {
  fetch("https://script.google.com/macros/s/AKfycbwqwRG4dE2luydPA5osamt3AMhoh2zNhuOOkXw-fiGj-QR2SDzxK5M_4FP5kDjlti8l/exec?action=getPlayer&playerId=${playerId}")
    .then(response => response.json())
    .then(playerData => {
      if (playerData.error) {
        console.warn("⚠️ 找不到玩家資料，可能是第一次登入");
        return;
      }

      Object.assign(pet, playerData);  // ✅ 把資料寫入你的 pet 物件
      updateChickenSprite();          // ✅ 更新圖片
      updateStatusBars();             // ✅ 更新狀態條
      updateNameDisplay();            // ✅ 更新名稱
      console.log("✅ 玩家資料載入成功", playerData);
    })
    .catch(err => {
      console.error("❌ 玩家資料載入失敗", err);
    });
}


// 🛌🛌🛌🛌🛌 睡眠控制邏輯 START 🛌🛌🛌🛌🛌
        function updateSleepButton() {
            if (pet.isSleeping) {
                sleepBtn.innerHTML = '<i class="fas fa-sun mr-1"></i> 叫醒';
            } else {
                sleepBtn.innerHTML = '<i class="fas fa-moon mr-1"></i> 睡覺';
            }
        }
        // 睡覺/醒來
        function toggleSleep() {
            if (pet.isDead) return;
            
            if (pet.isEating || pet.isPlaying) {
               randomTalk('sleeping');  // 睡著
               randomTalk('wake');      // 醒來 

                return;
            }
            
            pet.isSleeping = !pet.isSleeping;
            updateSleepButton();
            
            if (pet.isSleeping) {
                chicken.classList.add('sleeping');
               randomTalk('sleeping');  // 睡著

                addLog(`${pet.name}睡覺了`);
                
                // 顯示ZZZ動畫
                startZzz();
            } else {
                chicken.classList.remove('sleeping');
                randomTalk('wake');      // 醒來
                addLog(`${pet.name}醒來了`);
                
                // 清除ZZZ動畫
                clearZzz();
            }
            
            saveGame();
        }

        // 開始ZZZ動畫
        function startZzz() {
            clearZzz();
            zzzContainer.classList.remove('hidden');
            
            // 創建3個ZZZ
            for (let i = 0; i < 3; i++) {
                const zzz = document.createElement('div');
                zzz.className = 'zzz';
                zzz.textContent = 'Z';
                zzz.style.left = `${i * 10}px`;
                zzz.style.animationDelay = `${i * 0.5}s`;
                zzzContainer.appendChild(zzz);
            }
        }

        // 清除ZZZ動畫
        function clearZzz() {
            zzzContainer.innerHTML = '';
            zzzContainer.classList.add('hidden');
        }
// 🛌🛌🛌🛌🛌 睡眠控制邏輯 END 🛌🛌🛌🛌🛌
function showBackpack() {
  const backpackModal = document.getElementById('backpack-modal');
  const backpackItems = document.getElementById('backpack-items');
  backpackItems.innerHTML = ''; // 清空舊內容

  if (!backpack || Object.keys(backpack).length === 0) {
    backpackItems.innerHTML = '<p class="col-span-6 text-2xl text-center text-gray-500">目前背包是空的</p>';
    backpackModal.style.display = 'flex';
    return;
  }

  // 展平所有物品為一格一格（每個最多99，超過要拆分成多格）
  const slots = [];
  for (const [itemName, count] of Object.entries(backpack)) {
    let remaining = count;
    while (remaining > 0) {
      const stack = Math.min(99, remaining);
      slots.push({ name: itemName, count: stack });
      remaining -= stack;
    }
  }

  // 渲染格子（每頁30格）
  const totalSlots = Math.max(slots.length, 30);
  for (let i = 0; i < totalSlots; i++) {
    const slot = slots[i];
    const slotDiv = document.createElement('div');
    slotDiv.className = 'backpack-slot';

    if (slot) {
      slotDiv.textContent = slot.name;
      const countSpan = document.createElement('span');
      countSpan.className = 'item-count';
      countSpan.textContent = slot.count;
      slotDiv.appendChild(countSpan);
    }

    backpackItems.appendChild(slotDiv);
  }

  backpackModal.style.display = 'flex';
}

function saveToSheet() {
  const playerId = localStorage.getItem('playerId');
  if (!playerId) return;

  const data = {
    playerId: playerId,
    petName: pet.name,
    spriteName: pet.spriteName,
    level: pet.level,
    exp: pet.exp,
    coins: pet.coins || 0, // 如果沒 coins 屬性就設 0
    hunger: pet.hunger,
    happy: pet.happiness, // 這邊你的欄位是 happy，不是 happiness
    energy: pet.energy,
    clean: pet.cleanliness, // clean 對應 cleanliness
    isSick: pet.isSick || false, // 預設為 false
    weather: pet.weather || "sunny",
    backpack: JSON.stringify(backpack || {}),
    lastUpdate: new Date().toLocaleString()
  };

  fetch('https://script.google.com/macros/s/AKfycbwqwRG4dE2luydPA5osamt3AMhoh2zNhuOOkXw-fiGj-QR2SDzxK5M_4FP5kDjlti8l/exec?action=savePlayer', {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  })
    .then(res => res.text())
    .then(txt => console.log("✅ 玩家資料已儲存到試算表", txt))
    .catch(err => console.error("❌ 儲存失敗", err));
}


// 📀📀📀📀📀 儲存與載入功能 START 📀📀📀📀📀
     function saveGame() {
  const now = Date.now();
  pet.lastSaveTime = now;

  const gameData = {
    pet: pet,
    logs: Array.from(log.children).map(el => el.textContent).slice(0, 20) // 保存最近的20條日誌
  };

  localStorage.setItem('virtualPetChicken', JSON.stringify(gameData));

  // ✅ 同步儲存到 Google 試算表
  saveToSheet();
}
        // 加載遊戲
        function loadGame() {
            const savedData = localStorage.getItem('virtualPetChicken');
            if (savedData) {
                try {
                    const gameData = JSON.parse(savedData);
                    
                    // 恢復寵物狀態
                    Object.assign(pet, gameData.pet);
                    updateChickenSprite(); // ✅ 加這一行，根據 spriteName 套用對應角色圖片
                    
                    // 恢復日誌
                    log.innerHTML = '';
                    if (gameData.logs && gameData.logs.length > 0) {
                        gameData.logs.forEach(msg => {
                            const logEntry = document.createElement('p');
                            logEntry.textContent = msg;
                            log.appendChild(logEntry);
                        });
                    } else {
                        addLog("歡迎回來！");
                    }
                    
                    // 計算離線時間
                    const offlineTime = Date.now() - pet.lastSaveTime;
                    if (offlineTime > 60000) { // 超過1分鐘才計算
                        const offlineHours = Math.floor(offlineTime / 3600000);
                        const offlineMinutes = Math.floor((offlineTime % 3600000) / 60000);
                        
                        if (offlineHours > 0 || offlineMinutes > 0) {
                            addLog(`你離開了 ${offlineHours > 0 ? offlineHours + '小時' : ''}${offlineMinutes}分鐘`);
                        }
                    }
                    
                    // 根據離線時間更新狀態
                    updateOfflineStatus(offlineTime);
                    
                } catch (e) {
                    console.error("加載遊戲失敗:", e);
                    addLog("加載保存的遊戲失敗，開始新遊戲");
                    localStorage.removeItem('virtualPetChicken'); // 移除壞資料避免下次再跳錯
                }
            }
        }
        // 更新離線狀態
        function updateOfflineStatus(offlineTime) {
            if (pet.isDead) return;
            
            const hoursOffline = offlineTime / 3600000;
            const minutesOffline = offlineTime / 60000;
            
            // 飢餓度下降 (每10分鐘下降1%)
            const hungerDecrease = Math.min(100, Math.floor(minutesOffline / 10));
            pet.hunger = Math.max(0, pet.hunger - hungerDecrease);
            
            // 快樂度下降 (每小時下降5%)
            const happinessDecrease = Math.min(100, Math.floor(hoursOffline * 5));
            pet.happiness = Math.max(0, pet.happiness - happinessDecrease);
            
            // 精力變化 (睡覺時恢復，否則下降)
            if (pet.isSleeping) {
                const energyIncrease = Math.min(100, Math.floor(minutesOffline * 0.5)); // 每分鐘恢復0.5%
                pet.energy = Math.min(100, pet.energy + energyIncrease);
            } else {
                const energyDecrease = Math.min(100, Math.floor(minutesOffline / 15)); // 每15分鐘下降1%
                pet.energy = Math.max(0, pet.energy - energyDecrease);
            }
            
            // 清潔度下降 (每20分鐘下降1%)
            const cleanlinessDecrease = Math.min(100, Math.floor(minutesOffline / 20));
            pet.cleanliness = Math.max(0, pet.cleanliness - cleanlinessDecrease);
            
            
            updateStatusBars();
        }       
        
 // 📀📀📀📀📀 儲存與載入功能 END 📀📀📀📀📀

      


// 🐔🐔🐔🐔🐔 成長與邏輯 START 🐔🐔🐔🐔🐔      
        // 年齡增長
        function agePet() {
            if (pet.isDead) return;
            
            pet.age++;
            
            // 檢查是否成長
            if (pet.age === 1 && pet.growthStage === 0) {
                // 孵化
                pet.growthStage = 1;
                updateChickenSprite();
               randomTalk('wake')

                addLog(`雞蛋孵化了！${pet.name}誕生了！`);
            } else if (pet.age === 3 && pet.growthStage === 1) {
                // 長大
                pet.growthStage = 2;
                updateChickenSprite();
               randomTalk('walk')

                addLog(`${pet.name}長成了一隻成年雞！`);
            } else if (pet.age % 7 === 0 && pet.growthStage === 2) {
                // 升級
                pet.level++;
                randomTalk('walk')

                addLog(`${pet.name}升級了！現在是等級 ${pet.level}`);
            }
            
            updateStatusBars();
            saveGame();
        }
// 🐔🐔🐔🐔🐔 成長與邏輯 END 🐔🐔🐔🐔🐔

function gainExp(amount) {
  pet.exp += amount;

  while (pet.exp >= pet.maxExp) {
    pet.exp -= pet.maxExp;
    pet.level += 1;
    pet.maxExp = 100 + (pet.level - 1) * 50;
    addLog(`升級了！目前等級：${pet.level}`);
    levelDisplay.textContent = pet.level;
  }

  updateExpRing(pet.exp, pet.maxExp);
  saveGame();
}

function updateExpRing(currentExp, maxExp) {
  const percentage = (currentExp / maxExp) * 100;
  const dash = percentage.toFixed(2);
  const ring = document.getElementById("exp-ring");
  ring.setAttribute("stroke-dasharray", `${dash} 100`);
}



// 📢📢📢📢📢 日誌與對話 START 📢📢📢📢📢
 // 顯示對話泡泡
        // 添加日誌
        function addLog(message) {
            const logEntry = document.createElement('p');
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(logEntry);
            log.scrollTop = log.scrollHeight;
            
            // 限制日誌數量
            if (log.children.length > 20) {
                log.removeChild(log.children[0]);
            }
        }
// ✅ 探險主程式：進入洞穴
function startExploration(place) {
  document.getElementById('explore-modal').style.display = 'none';
  document.body.classList.add('exploring');
  addLog(`${pet.name} 前往 ${place} 探險中...`);

  // ✅ 改這一行：用 Gemini 說話而不是表格
  randomTalk('explore');

  switch (place) {
    case '咕咕洞穴':
      petArea.style.backgroundImage = "url('https://i.imgur.com/kc15Z8F.png')";
      break;
    case '神秘洞穴':
      petArea.style.backgroundImage = "url('https://i.imgur.com/pAeHXzQ.png')";
      break;
    case '黑暗森林':
      petArea.style.backgroundImage = "url('https://i.imgur.com/bEyKtwO.png')";
      break;
  }

  petArea.style.backgroundSize = 'cover';
  petArea.style.backgroundPosition = 'center';

  pet.position.x = window.innerWidth / 2;
  pet.position.y = window.innerHeight / 2;
  updatePosition();
  startExplorationMove();
}
// ✅ 關閉洞穴選單（還沒探險前）
function closeExploreModal() {
  document.getElementById('explore-modal').style.display = 'none';
}
// ✅ 探險結束，恢復原狀
function endExploration() {
  stopExplorationMove();  // 停止走動
  const drops = getExploreRewards();  // 探險掉落
  showRewardModal(drops);  // 顯示獎勵模態框

  // ✅ 停止左右移動
  stopExplorationMove();

  // ✅ 回復原本背景（根據天氣重設）
  updateWeather();
}
// ✅ 探險中的角色左右自動移動
let exploreInterval = null;



function showRewardModal(drops) {
  const modal = document.getElementById('explore-reward-modal');
  const rewardBox = document.getElementById('reward-items');
  rewardBox.innerHTML = drops.map(item => `🎁 ${item}`).join('<br>');
  modal.style.display = 'flex';
}


function startExplorationMove() {
  if (exploreInterval) return;

  let movingRight = true;
  exploreInterval = setInterval(() => {
    const areaWidth = petArea.clientWidth;

    if (movingRight) {
      pet.direction = 1;
      pet.position.x += 50;
      if (pet.position.x >= areaWidth - 100) movingRight = false;
    } else {
      pet.direction = -1;
      pet.position.x -= 50;
      if (pet.position.x <= 100) movingRight = true;
    }

    chicken.classList.add('walking');
    updatePosition();
    setTimeout(() => chicken.classList.remove('walking'), 400);

    // ✅ 改這一行：改成 Gemini 說話
    if (Math.random() > 0.5) {
      randomTalk('explore');
    }
  }, 1000);
}


function getExploreRewards() {
  const place = getCurrentExplorePlace();
  const table = dropTable[place] || [];
  const result = [];

  for (let i = 0; i < 2 + Math.floor(Math.random() * 2); i++) {
    const item = table[Math.floor(Math.random() * table.length)];
    result.push(item);
    backpack[item] = Math.min(99, (backpack[item] || 0) + 1);
  }
  return result;
}

function getCurrentExplorePlace() {
  const bg = petArea.style.backgroundImage;
  if (bg.includes("kc15Z8F")) return '咕咕洞穴';
  if (bg.includes("pAeHXzQ")) return '神秘洞穴';
  if (bg.includes("bEyKtwO")) return '黑暗森林';
  return '未知地點';
}

function showRewardModal(drops) {
  const modal = document.getElementById('explore-reward-modal');
  const rewardBox = document.getElementById('reward-items');
  rewardBox.innerHTML = drops.map(item => `🎁 ${item}`).join('<br>');
  modal.style.display = 'flex';
}



function stopExplorationMove() {
  clearInterval(exploreInterval);
  exploreInterval = null;
}
function confirmReward() {
  document.getElementById('explore-reward-modal').style.display = 'none';
  updateWeather(); // 還原背景
  document.body.classList.remove('exploring'); // 離開探險模式
  addLog(`${pet.name} 把獲得的寶物放進背包`);
  gainExp(200000); // 探險結束後增加 20 經驗值（可依情況調整）
  saveGame();
}
function closeBackpack() {
  document.getElementById('backpack-modal').style.display = 'none';
}


// 📢📢📢📢📢 日誌與對話 END 📢📢📢📢📢
        // 更新寵物狀態
        function updatePetStatus() {
            if (pet.isDead) return;
            
            const now = Date.now();
            
            // 飢餓度下降 (每10分鐘下降1%)
            if (now - pet.lastHungerDecrease > 600000) {
                pet.hunger = Math.max(0, pet.hunger - 1);
                pet.lastHungerDecrease = now;
            }
            
            // 快樂度下降
            if (now - pet.lastHappinessDecrease > 5000 && !pet.isSleeping) {
                pet.happiness = Math.max(0, pet.happiness - 1);
                pet.lastHappinessDecrease = now;
            }
            
            // 精力下降或恢復
            if (pet.isSleeping) {
                if (now - pet.lastEnergyDecrease > 2000) {
                    pet.energy = Math.min(100, pet.energy + 2);
                    pet.lastEnergyDecrease = now;
                }
            } else {
                // 每15分鐘下降1%
                if (now - pet.lastEnergyDecrease > 900000) {
                    pet.energy = Math.max(0, pet.energy - 1);
                    pet.lastEnergyDecrease = now;
                }
            }
            
            // 清潔度下降 (每20分鐘下降1%)
            if (now - pet.lastCleanlinessDecrease > 1200000) {
                pet.cleanliness = Math.max(0, pet.cleanliness - 1);
                pet.lastCleanlinessDecrease = now;
            }
            

            updateStatusBars();
            
            // 每5分鐘自動保存一次
            if (now - pet.lastSaveTime > 300000) {
                saveGame();
            }
        }

       
// 🧼🧼🧼🧼🧼 玩家互動功能區 START 🧼🧼🧼🧼🧼
        // 餵食
        function feedPet() {
            if (pet.isDead) return;
            
            if (pet.isSleeping) {
                randomTalk('eating');
                return;
            }
            
            if (pet.isEating) {
                randomTalk('eating');
                return;
            }
            
            pet.isEating = true;
            chicken.classList.add('eating');
            randomTalk('eating');
            
            // 生成食物
            spawnFood();
            
            setTimeout(() => {
                pet.hunger = Math.min(100, pet.hunger + 20);
                pet.isEating = false;
                chicken.classList.remove('eating');
                updateStatusBars();
                addLog(`你餵了${pet.name}`);
                saveGame();
            }, 2000);
        }

        // 玩耍
        function playWithPet() {
            if (pet.isDead) return;
            
            if (pet.isSleeping) {
               randomTalk('playing');
                return;
            }
            
            if (pet.isPlaying) {
                randomTalk('playing');

                return;
            }
            
            pet.isPlaying = true;
            chicken.classList.add('playing');
            randomTalk('playing');

            
            // 生成玩具
            spawnToy();
            
            setTimeout(() => {
                pet.happiness = Math.min(100, pet.happiness + 20);
                pet.energy = Math.max(0, pet.energy - 3); // 每次玩耍減少3%精力
                pet.isPlaying = false;
                chicken.classList.remove('playing');
                updateStatusBars();
                addLog(`你和${pet.name}玩耍了`);
                saveGame();
            }, 2000);
        }

        // 清潔
        function cleanPet() {
            if (pet.isDead) return;
            
            if (pet.isSleeping) {
               randomTalk('dirty');

                return;
            }
            
            randomTalk('dirty');
            pet.cleanliness = 100;
            
            // 清除所有大便
            poopContainer.innerHTML = '';
            
            updateStatusBars();
            addLog(`你清潔了${pet.name}`);
            saveGame();
        }
// 🧼🧼🧼🧼🧼 玩家互動功能區 END 🧼🧼🧼🧼🧼

// 🌐 載入對角色資料
let evolutionData = [];

function loadEvolutionData() {
  fetch("https://script.google.com/macros/s/AKfycbwqwRG4dE2luydPA5osamt3AMhoh2zNhuOOkXw-fiGj-QR2SDzxK5M_4FP5kDjlti8l/exec?action=getEvolution")
    .then(response => response.json())
    .then(data => {
      evolutionData = data;
       console.log("✅ 進化資料已載入", loadEvolutionData);
  })
    .catch(err => console.error("進化資料載入失敗", err));
}


// 🌐 載入對話資料
let petSpeech = {};
fetch("https://script.google.com/macros/s/AKfycbwqwRG4dE2luydPA5osamt3AMhoh2zNhuOOkXw-fiGj-QR2SDzxK5M_4FP5kDjlti8l/exec?action=getPetSpeech")
  .then(response => response.json())
  .then(data => {
    petSpeech = data;
    console.log("✅ 對話內容已載入", petSpeech);
  })
  .catch(error => {
    console.error("❌ 載入說話資料失敗", error);
  });


document.getElementById('login-btn').addEventListener('click', () => {
  const input = document.getElementById('player-id-input');
  const id = input.value.trim();

  if (!id) {
    alert('請輸入玩家帳號');
    return;
  }

  localStorage.setItem('playerId', id);
  document.getElementById('login-modal').style.display = 'none';

  // 如果要馬上載入玩家資料
  fetchPlayerRecord(id);
});



 // 初始化網頁載入完成後要做的事情
window.onload = () => {
 const playerId = localStorage.getItem('playerId');

  if (!playerId) {
    // ⛔ 沒登入 → 顯示登入視窗
    document.getElementById('login-modal').style.display = 'flex';
    return;
  }

  fetch("https://script.google.com/macros/s/AKfycbwqwRG4dE2luydPA5osamt3AMhoh2zNhuOOkXw-fiGj-QR2SDzxK5M_4FP5kDjlti8l/exec?action=getEvolution")
    .then(response => response.json())
    .then(data => {
      evolutionData = data;
      console.log("✅ 進化資料已載入");
      initPet(); // ✅ 資料載入後才初始化遊戲
       fetchPlayerRecord(playerId); // 這是你第 5 步要寫的函式
    })
    
    .catch(err => console.error("進化資料載入失敗", err));
};

document.getElementById('weather-toggle').addEventListener('click', toggleWeather);
updateWeather();

document.getElementById('explore-btn').addEventListener('click', () => {
  if (pet.isDead) return;
  document.getElementById('explore-modal').style.display = 'flex';
});

document.getElementById('end-explore-btn').addEventListener('click', endExploration);

// ✅ 這行一定要加，先抓到按鈕
const bagBtn = document.getElementById('bag-btn');

// ✅ 點背包按鈕顯示背包
bagBtn.addEventListener('click', showBackpack);

// 在頁面關閉前保存遊戲
window.addEventListener('beforeunload', () => {
  saveGame();
});

// ✅ 重置按鈕
document.getElementById('reset-btn').addEventListener('click', () => {
  if (confirm("你確定要重置遊戲嗎？這會清除所有進度！")) {
    localStorage.removeItem('virtualPetChicken');

    // 顯示 "重置中..."
    document.body.innerHTML = `
      <div style="color: white; background: black; height: 100vh; display: flex; justify-content: center; align-items: center; font-size: 48px;">
        重置中...
      </div>
    `;

    setTimeout(() => {
      // ✅ 換成重新導向首頁網址（你的 GAS 網址）
      window.location.href = "https://script.google.com/macros/s/AKfycbwqwRG4dE2luydPA5osamt3AMhoh2zNhuOOkXw-fiGj-QR2SDzxK5M_4FP5kDjlti8l/exec";
    }, 500);
  }
});
// ✅ 登入按鈕事件處理
document.getElementById('login-confirm-btn').addEventListener('click', () => {
  const input = document.getElementById('player-id-input');
  const playerId = input.value.trim();

  if (!playerId) {
    alert("請輸入帳號！");
    return;
  }

  localStorage.setItem('playerId', playerId);             // ✅ 存入本機帳號
  document.getElementById('login-modal').style.display = 'none'; // ✅ 關閉登入視窗
  window.location.reload();                                // ✅ 重新載入畫面，啟動 onload 初始化流程
});


</script>
<!-- 🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠 JavaScript 遊戲邏輯區塊   END 🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠🧠 --> 
</body>
</html>

